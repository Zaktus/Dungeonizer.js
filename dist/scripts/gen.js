!function(r,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t=n();for(var e in t)("object"==typeof exports?exports:r)[e]=t[e]}}(this,function(){return function(r){function n(e){if(t[e])return t[e].exports;var a=t[e]={exports:{},id:e,loaded:!1};return r[e].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}var t={};return n.m=r,n.c=t,n.p="",n(0)}([function(r,n,t){r.exports=t(2)},,function(r,n,t){"use strict";function e(r,n){return r.x-r.w/2<n.x+n.w/2&&r.x+r.w/2>n.x-n.w/2&&r.y+r.h/2>n.y-n.h/2&&r.y-r.h/2<n.y+n.h/2}function a(r,n,t,e,a,o,h,i){if(r>Math.min(a,h)&&r<Math.max(a,h)){if(o>Math.min(n,e)&&o<Math.max(n,e)||i>Math.min(n,e)&&i<Math.max(n,e))return!0}else if(n>Math.min(o,i)&&n<Math.max(o,i)&&(a>Math.min(r,t)&&a<Math.max(r,t)||h>Math.min(r,t)&&h<Math.max(r,t)))return!0;return!1}function o(r,n){return(r[0]-n[0])*(r[0]-n[0])+(r[1]-n[1])*(r[1]-n[1])}function h(r,n,t,e){e.push(r);for(var a=!1,o=!1,i=0;i<t[r].length;i++){for(var f=0;f<e.length;f++){if(t[r][i]===n){o=!0;break}if(e[f]===t[r][i]){a=!0;break}}a||o||(o=o||h(t[r][i],n,t,e))}return o}function i(r,n,t){for(var e=[r],a=!1,o=0;o<t[r].length;o++)t[r][o]!==n&&(a=a||h(t[r][o],n,t,e));return a}function f(r,n){var t=[],e=r.x-n.x,a=r.y-n.y,o=(r.w+n.w)/2-Math.abs(e),h=(r.h+n.h)/2-Math.abs(a);if(o>0){var i=r.x<n.x?r.x+r.w/2:n.x+n.w/2;i-=(.6*Math.random()+.2)*o,t=a<0?[i,r.y+r.h/2,i,n.y-n.h/2]:[i,r.y-r.h/2,i,n.y+n.h/2]}else if(h>0){var f=r.y<n.y?r.y+r.h/2:n.y+n.h/2;f-=(.6*Math.random()+.2)*h,t=e<0?[r.x+r.w/2,f,n.x-n.w/2,f]:[r.x-r.w/2,f,n.x+n.w/2,f]}else{var u=a<0?r.y+r.h/2:r.y-r.h/2,s=r.x+(Math.random()-.5)*r.w*.8,l=e<0?n.x-n.w/2:n.x+n.w/2,p=n.y+(Math.random()-.5)*n.h*.8;t=[s,u,s,p,s,p,l,p]}return t}console.warn("In generator");var u=t(3);window.dungeonizer=window.dungeonizer||{},window.dungeonizer.generateDungeon=function(){var r,n,t,h,s,l,p,x=13,c=5*x+Math.floor(10*Math.random()),y=4,M=14,d=[];for(r=0;r<c;r++)s=y+Math.floor(Math.random()*(M-y)),l=y+Math.floor(Math.random()*(M-y)),p=s*l,d.push({x:0,y:0,w:s,h:l,size:p,x1:-s/2,x2:s/2,y1:-l/2,y2:l/2,isMain:0});var g=(d.slice(),c*M*2);for(r=1;r<c;r++){var v=2*Math.random()*Math.PI,b=0,m=0,w=Math.cos(v),I=Math.sin(v);for(t=0;t<g;t++){b+=w,m+=I,d[r].x=b,d[r].y=m;var N=!1;for(n=0;n<r;n++)if(e(d[n],d[r])){N=!0;break}if(!N){for(var k,T,j=Math.sqrt(b*b+m*m),E=v;E-v<2*Math.PI;)for(E+=Math.PI/2,h=j;h>0;h--){for(k=h*Math.cos(E),T=h*Math.sin(E),N=!1,n=0;n<r;n++)if(d[r].x=k,d[r].y=T,e(d[n],d[r])){N=!0;break}N||(j=h,b=k,m=T)}d[r].x=b,d[r].y=m;break}}d[r].x1=-d[r].w/2+d[r].x,d[r].x2=d[r].w/2+d[r].x,d[r].y1=-d[r].h/2+d[r].y,d[r].y2=d[r].h/2+d[r].y}var S=[],q=.75*M;for(r=0;r<d.length;r++)d[r].size>q*q&&(d[r].isMain=1,S.push([d[r].x,d[r].y,r]));var A,z,P,F,O,V,Y=u.triangulate(S),_=[],D=[],G=[];for(r=0;r<Y.length-1;r+=3){for(A=Y[r],z=Y[r+1],P=Y[r+2],_.push(S[A][0],S[A][1],S[z][0],S[z][1],S[A][0],S[A][1],S[P][0],S[P][1],S[z][0],S[z][1],S[P][0],S[P][1]),G[A]||(G[A]=[]),G[z]||(G[z]=[]),G[P]||(G[P]=[]),F=!1,O=!1,n=0;n<G[A].length;n++)G[A][n]===z&&(F=!0),G[A][n]===P&&(O=!0);for(n=0;n<G[z].length;n++)G[z][n]===P&&(V=!0);F||(G[A].push(z),G[z].push(A),D.push({a:A,b:z,dSq:o(S[A],S[z])})),O||(G[A].push(P),G[P].push(A),D.push({a:A,b:P,dSq:o(S[A],S[P])})),V||(G[z].push(P),G[P].push(z),D.push({a:z,b:P,dSq:o(S[z],S[P])}))}D.sort(function(r,n){return r.dSq-n.dSq});var C,L,B,H,J=9,K=0,Q=[];for(r=D.length-1;r>=0;r--)C=!1,L=D[r].a,B=D[r].b,C=i(L,B,G),C&&(K>0&&Q.push({a:L,b:B}),H=G[L].indexOf(B),G[L].splice(H,1),H=G[B].indexOf(L),G[B].splice(H,1),D.splice(r,1),K--,K<-J+2&&(K=1));var R,U=[],W=[];for(r=0;r<D.length;r++)W.push(S[D[r].a][0],S[D[r].a][1],S[D[r].b][0],S[D[r].b][1]),R=f(d[S[D[r].a][2]],d[S[D[r].b][2]]),Array.prototype.push.apply(U,R);var X=[];for(r=0;r<Q.length;r++)X.push(S[Q[r].a][0],S[Q[r].a][1],S[Q[r].b][0],S[Q[r].b][1]),R=f(d[S[Q[r].a][2]],d[S[Q[r].b][2]]),Array.prototype.push.apply(U,R);var Z;for(r=0;r<d.length;r++)if(Z=d[r],Z.isMain<1)for(n=0;n<U.length;n+=4)if(a(U[n],U[n+1],U[n+2],U[n+3],Z.x1,Z.y1,Z.x2,Z.y2)!==!1){Z.isMain=2;break}return{floors:d,fullDelaunayTriangles:_,triangles:W,leftAliveLines:X,tunnels:U}}},function(r,n,t){"use strict";var e;!function(){function n(r){var n,t,e,a,o,h,i=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(n=r.length;n--;)r[n][0]<i&&(i=r[n][0]),r[n][0]>u&&(u=r[n][0]),r[n][1]<f&&(f=r[n][1]),r[n][1]>s&&(s=r[n][1]);return t=u-i,e=s-f,a=Math.max(t,e),o=i+.5*t,h=f+.5*e,[[o-20*a,h-a],[o,h+20*a],[o+20*a,h-a]]}function t(r,n,t,e){var a,h,i,f,u,s,l,p,x,c,y=r[n][0],M=r[n][1],d=r[t][0],g=r[t][1],v=r[e][0],b=r[e][1],m=Math.abs(M-g),w=Math.abs(g-b);if(m<o&&w<o)throw new Error("Eek! Coincident points!");return m<o?(f=-((v-d)/(b-g)),s=(d+v)/2,p=(g+b)/2,a=(d+y)/2,h=f*(a-s)+p):w<o?(i=-((d-y)/(g-M)),u=(y+d)/2,l=(M+g)/2,a=(v+d)/2,h=i*(a-u)+l):(i=-((d-y)/(g-M)),f=-((v-d)/(b-g)),u=(y+d)/2,s=(d+v)/2,l=(M+g)/2,p=(g+b)/2,a=(i*u-f*s+p-l)/(i-f),h=m>w?i*(a-u)+l:f*(a-s)+p),x=d-a,c=g-h,{i:n,j:t,k:e,x:a,y:h,r:x*x+c*c}}function a(r){var n,t,e,a,o,h;for(t=r.length;t;)for(a=r[--t],e=r[--t],n=t;n;)if(h=r[--n],o=r[--n],e===o&&a===h||e===h&&a===o){r.splice(t,2),r.splice(n,2);break}}var o=1/1048576;e={triangulate:function(r,e){var h,i,f,u,s,l,p,x,c,y,M,d,g=r.length;if(g<3)return[];if(r=r.slice(0),e)for(h=g;h--;)r[h]=r[h][e];for(f=new Array(g),h=g;h--;)f[h]=h;for(f.sort(function(n,t){return r[t][0]-r[n][0]}),u=n(r),r.push(u[0],u[1],u[2]),s=[t(r,g+0,g+1,g+2)],l=[],p=[],h=f.length;h--;p.length=0){for(d=f[h],i=s.length;i--;)x=r[d][0]-s[i].x,x>0&&x*x>s[i].r?(l.push(s[i]),s.splice(i,1)):(c=r[d][1]-s[i].y,x*x+c*c-s[i].r>o||(p.push(s[i].i,s[i].j,s[i].j,s[i].k,s[i].k,s[i].i),s.splice(i,1)));for(a(p),i=p.length;i;)M=p[--i],y=p[--i],s.push(t(r,y,M,d))}for(h=s.length;h--;)l.push(s[h]);for(s.length=0,h=l.length;h--;)l[h].i<g&&l[h].j<g&&l[h].k<g&&s.push(l[h].i,l[h].j,l[h].k);return s},contains:function(r,n){if(n[0]<r[0][0]&&n[0]<r[1][0]&&n[0]<r[2][0]||n[0]>r[0][0]&&n[0]>r[1][0]&&n[0]>r[2][0]||n[1]<r[0][1]&&n[1]<r[1][1]&&n[1]<r[2][1]||n[1]>r[0][1]&&n[1]>r[1][1]&&n[1]>r[2][1])return null;var t=r[1][0]-r[0][0],e=r[2][0]-r[0][0],a=r[1][1]-r[0][1],o=r[2][1]-r[0][1],h=t*o-e*a;if(0===h)return null;var i=(o*(n[0]-r[0][0])-e*(n[1]-r[0][1]))/h,f=(t*(n[1]-r[0][1])-a*(n[0]-r[0][0]))/h;return i<0||f<0||i+f>1?null:[i,f]}},r.exports=e}()}])});