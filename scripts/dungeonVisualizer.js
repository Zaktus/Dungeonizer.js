!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(2),i=o(a),s=n(13),u=o(s),c=n(14),l=function d(){function e(){var e=o.clientWidth,t=o.clientHeight;o.width===e&&o.height===t||(o.width=e*f,o.height=t*f,s.resize(e,t),m.viewport(0,0,m.drawingBufferWidth,m.drawingBufferHeight))}function t(){e(),s.update(),requestAnimationFrame(t)}if(r(this,d),!c())return void(document.body.innerHTML="Unable to initialize WebGL. Your browser may not support it.");var n=new THREE.WebGLRenderer({antialias:!0,alpha:!0});if(n.extensions.get("ANGLE_instanced_arrays")===!1)return void(document.body.innerHTML="Unable to get ANGLE_instanced_arrays WebGL extension. Your browser may not support it.");var o=n.domElement;o.className="canvas";var a=document.getElementById("root");a.appendChild(o),a.style.backgroundColor="red";var s=new i["default"](n),l=new u["default"](s);l.resetDungeon();var m=n.getContext(),f=window.devicePixelRatio||1;t()};window.app=new l},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(3),s=o(i),u=n(5),c=o(u),l=n(8),d=o(l),m=n(11),f=o(m),h=n(12),v=o(h),p=function(){function e(t){r(this,e),this.renderer=t,this.renderer.setClearColor(1118481,!1),this.renderer.setPixelRatio(window.devicePixelRatio||1);var n=this.renderer.getContext(),o=n.canvas.clientWidth/n.canvas.clientHeight;this.camera=new THREE.PerspectiveCamera(60,o,.1,2e3),this.camera.position.set(-90,110,50),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.camera.updateProjectionMatrix(),this.controls=new s["default"](this.camera,this.renderer.domElement),this.scene=new THREE.Scene;var a=new THREE.AmbientLight(2105376);this.scene.add(a);var i=new THREE.DirectionalLight(7368816);i.position.set(10,20,10),this.scene.add(i);var u=new THREE.DirectionalLight(7368816);u.position.set(-30,20,10),this.scene.add(u)}return a(e,[{key:"createDungeonMesh",value:function(e,t){var n=Boolean(e.mstLines&&e.leftAliveLines&&e.delaunayTriangles&&e.trashRooms),o=Boolean(e.walls),r=new THREE.Object3D;r.name="Dungeon_"+t;var a=new c["default"](e.rooms,{isDebug:n,isTrashFloors:!1,config:v["default"].visParams});a.frustumCulled=!1,r.add(a);var i=new d["default"](e.tunnels,{isDebug:n,config:v["default"].visParams});if(i.frustumCulled=!1,r.add(i),o){var s=new d["default"](e.walls,{isDebug:n,config:v["default"].visParams,isWall:!0});s.frustumCulled=!1,r.add(s)}if(n){var u=new f["default"](e.delaunayTriangles,8947848);r.add(u);var l=new f["default"](e.mstLines,255);r.add(l);var m=new f["default"](e.leftAliveLines,16711680);r.add(m);var h=new c["default"](e.trashRooms,{isDebug:n,isTrashFloors:!0,config:v["default"].visParams});h.frustumCulled=!1,r.add(h)}return r}},{key:"update",value:function(){this.controls.update(),this.renderer.render(this.scene,this.camera)}},{key:"resize",value:function(e,t){var n=e/t;this.camera.aspect!==n&&(this.camera.aspect=n,this.camera.updateProjectionMatrix())}},{key:"dispose",value:function(){this.controls.dispose(),this.clearScene()}},{key:"makeDungeonVisual",value:function(e,t){this.clearScene();var n=this.createDungeonMesh(e,t);this.scene.add(n)}},{key:"clearScene",value:function(){for(var e=this.scene.children.length-1;e>=0;e--){var t=this.scene.children[e];if(t.name.includes("Dungeon")){for(var n=t.children.length-1;n>=0;n--){var o=t.children[n];if(o instanceof THREE.Mesh)o.material.dispose(),o.geometry.dispose();else for(var r=o.children.length-1;r>=0;r--){var a=o.children[r];a.material.dispose(),a.geometry.dispose(),a.parent.remove(a)}o.parent.remove(o)}t.parent.remove(t)}}}}]),e}();t["default"]=p},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();window.THREE=THREE,n(4);var a=function(){function e(t,n){o(this,e),this.orbitControls=new THREE.OrbitControls(t,n),this.orbitControls.enableDamping=!0,this.orbitControls.minDistance=1,this.orbitControls.maxDistance=1e3,this.orbitControls.rotateSpeed=.25}return r(e,[{key:"update",value:function(){this.orbitControls.update()}},{key:"dispose",value:function(){this.orbitControls.dispose()}}]),e}();t["default"]=a},function(e,t){THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*j.autoRotateSpeed}function o(){return Math.pow(.95,j.zoomSpeed)}function r(e){z.theta-=e}function a(e){z.phi-=e}function i(e){j.object instanceof THREE.PerspectiveCamera?V/=e:j.object instanceof THREE.OrthographicCamera?(j.object.zoom=Math.max(j.minZoom,Math.min(j.maxZoom,j.object.zoom*e)),j.object.updateProjectionMatrix(),Y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),j.enableZoom=!1)}function s(e){j.object instanceof THREE.PerspectiveCamera?V*=e:j.object instanceof THREE.OrthographicCamera?(j.object.zoom=Math.max(j.minZoom,Math.min(j.maxZoom,j.object.zoom/e)),j.object.updateProjectionMatrix(),Y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),j.enableZoom=!1)}function u(e){G.set(e.clientX,e.clientY)}function c(e){Q.set(e.clientX,e.clientY)}function l(e){X.set(e.clientX,e.clientY)}function d(e){Z.set(e.clientX,e.clientY),W.subVectors(Z,G);var t=j.domElement===document?j.domElement.body:j.domElement;r(2*Math.PI*W.x/t.clientWidth*j.rotateSpeed),a(2*Math.PI*W.y/t.clientHeight*j.rotateSpeed),G.copy(Z),j.update()}function m(e){J.set(e.clientX,e.clientY),$.subVectors(J,Q),$.y>0?i(o()):$.y<0&&s(o()),Q.copy(J),j.update()}function f(e){q.set(e.clientX,e.clientY),K.subVectors(q,X),ne(K.x,K.y),X.copy(q),j.update()}function h(e){}function v(e){e.deltaY<0?s(o()):e.deltaY>0&&i(o()),j.update()}function p(e){switch(e.keyCode){case j.keys.UP:ne(0,j.keyPanSpeed),j.update();break;case j.keys.BOTTOM:ne(0,-j.keyPanSpeed),j.update();break;case j.keys.LEFT:ne(j.keyPanSpeed,0),j.update();break;case j.keys.RIGHT:ne(-j.keyPanSpeed,0),j.update()}}function b(e){G.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);Q.set(0,o)}function E(e){X.set(e.touches[0].pageX,e.touches[0].pageY)}function w(e){Z.set(e.touches[0].pageX,e.touches[0].pageY),W.subVectors(Z,G);var t=j.domElement===document?j.domElement.body:j.domElement;r(2*Math.PI*W.x/t.clientWidth*j.rotateSpeed),a(2*Math.PI*W.y/t.clientHeight*j.rotateSpeed),G.copy(Z),j.update()}function y(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);J.set(0,r),$.subVectors(J,Q),$.y>0?s(o()):$.y<0&&i(o()),Q.copy(J),j.update()}function T(e){q.set(e.touches[0].pageX,e.touches[0].pageY),K.subVectors(q,X),ne(K.x,K.y),X.copy(q),j.update()}function R(e){}function H(e){if(j.enabled!==!1){if(e.preventDefault(),e.button===j.mouseButtons.ORBIT){if(j.enableRotate===!1)return;u(e),I=U.ROTATE}else if(e.button===j.mouseButtons.ZOOM){if(j.enableZoom===!1)return;c(e),I=U.DOLLY}else if(e.button===j.mouseButtons.PAN){if(j.enablePan===!1)return;l(e),I=U.PAN}I!==U.NONE&&(document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",M,!1),j.dispatchEvent(_))}}function P(e){if(j.enabled!==!1)if(e.preventDefault(),I===U.ROTATE){if(j.enableRotate===!1)return;d(e)}else if(I===U.DOLLY){if(j.enableZoom===!1)return;m(e)}else if(I===U.PAN){if(j.enablePan===!1)return;f(e)}}function M(e){j.enabled!==!1&&(h(e),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",M,!1),j.dispatchEvent(N),I=U.NONE)}function x(e){j.enabled===!1||j.enableZoom===!1||I!==U.NONE&&I!==U.ROTATE||(e.preventDefault(),e.stopPropagation(),v(e),j.dispatchEvent(_),j.dispatchEvent(N))}function C(e){j.enabled!==!1&&j.enableKeys!==!1&&j.enablePan!==!1&&p(e)}function D(e){if(j.enabled!==!1){switch(e.touches.length){case 1:if(j.enableRotate===!1)return;b(e),I=U.TOUCH_ROTATE;break;case 2:if(j.enableZoom===!1)return;g(e),I=U.TOUCH_DOLLY;break;case 3:if(j.enablePan===!1)return;E(e),I=U.TOUCH_PAN;break;default:I=U.NONE}I!==U.NONE&&j.dispatchEvent(_)}}function O(e){if(j.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(j.enableRotate===!1)return;if(I!==U.TOUCH_ROTATE)return;w(e);break;case 2:if(j.enableZoom===!1)return;if(I!==U.TOUCH_DOLLY)return;y(e);break;case 3:if(j.enablePan===!1)return;if(I!==U.TOUCH_PAN)return;T(e);break;default:I=U.NONE}}function A(e){j.enabled!==!1&&(R(e),j.dispatchEvent(N),I=U.NONE)}function L(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return k.phi},this.getAzimuthalAngle=function(){return k.theta},this.reset=function(){j.target.copy(j.target0),j.object.position.copy(j.position0),j.object.zoom=j.zoom0,j.object.updateProjectionMatrix(),j.dispatchEvent(S),j.update(),I=U.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),a=o.clone().inverse(),i=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=j.object.position;return t.copy(e).sub(j.target),t.applyQuaternion(o),k.setFromVector3(t),j.autoRotate&&I===U.NONE&&r(n()),k.theta+=z.theta,k.phi+=z.phi,k.theta=Math.max(j.minAzimuthAngle,Math.min(j.maxAzimuthAngle,k.theta)),k.phi=Math.max(j.minPolarAngle,Math.min(j.maxPolarAngle,k.phi)),k.makeSafe(),k.radius*=V,k.radius=Math.max(j.minDistance,Math.min(j.maxDistance,k.radius)),j.target.add(B),t.setFromSpherical(k),t.applyQuaternion(a),e.copy(j.target).add(t),j.object.lookAt(j.target),j.enableDamping===!0?(z.theta*=1-j.dampingFactor,z.phi*=1-j.dampingFactor):z.set(0,0,0),V=1,B.set(0,0,0),!!(Y||i.distanceToSquared(j.object.position)>F||8*(1-s.dot(j.object.quaternion))>F)&&(j.dispatchEvent(S),i.copy(j.object.position),s.copy(j.object.quaternion),Y=!1,!0)}}(),this.dispose=function(){j.domElement.removeEventListener("contextmenu",L,!1),j.domElement.removeEventListener("mousedown",H,!1),j.domElement.removeEventListener("wheel",x,!1),j.domElement.removeEventListener("touchstart",D,!1),j.domElement.removeEventListener("touchend",A,!1),j.domElement.removeEventListener("touchmove",O,!1),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",M,!1),window.removeEventListener("keydown",C,!1)};var j=this,S={type:"change"},_={type:"start"},N={type:"end"},U={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},I=U.NONE,F=1e-6,k=new THREE.Spherical,z=new THREE.Spherical,V=1,B=new THREE.Vector3,Y=!1,G=new THREE.Vector2,Z=new THREE.Vector2,W=new THREE.Vector2,X=new THREE.Vector2,q=new THREE.Vector2,K=new THREE.Vector2,Q=new THREE.Vector2,J=new THREE.Vector2,$=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),B.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),B.add(e)}}(),ne=function(){var e=new THREE.Vector3;return function(t,n){var o=j.domElement===document?j.domElement.body:j.domElement;if(j.object instanceof THREE.PerspectiveCamera){var r=j.object.position;e.copy(r).sub(j.target);var a=e.length();a*=Math.tan(j.object.fov/2*Math.PI/180),ee(2*t*a/o.clientHeight,j.object.matrix),te(2*n*a/o.clientHeight,j.object.matrix)}else j.object instanceof THREE.OrthographicCamera?(ee(t*(j.object.right-j.object.left)/j.object.zoom/o.clientWidth,j.object.matrix),te(n*(j.object.top-j.object.bottom)/j.object.zoom/o.clientHeight,j.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),j.enablePan=!1)}}();j.domElement.addEventListener("contextmenu",L,!1),j.domElement.addEventListener("mousedown",H,!1),j.domElement.addEventListener("wheel",x,!1),j.domElement.addEventListener("touchstart",D,!1),j.domElement.addEventListener("touchend",A,!1),j.domElement.addEventListener("touchmove",O,!1),window.addEventListener("keydown",C,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}})},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),i=o(a),s=n(7),u=o(s),c=function l(e,t){var n=t.isDebug,o=t.isTrashFloors,a=t.config;r(this,l);for(var s=[],c=[],d=[],m=n?a.mainFloorDebugColor:a.floorTunnelColor,f=a.attachedFloorDebugColor,h=a.trashFloorDebugColor,v=o?a.trashFloorY:0,p=0;p<e.length;p++)s.push(e[p].x,v,e[p].y),c.push(e[p].w,a.floorHeight,e[p].h),d.push.apply(d,o?h:e[p].isAttached?f:m);var b=new THREE.BoxBufferGeometry(1,1,1),g=new THREE.InstancedBufferGeometry;g.addAttribute("position",b.attributes.position),g.addAttribute("normal",b.attributes.normal),g.addAttribute("uv",b.attributes.uv),g.setIndex(b.index),g.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(s),3,1)),g.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(c),3,1)),g.addAttribute("color",new THREE.InstancedBufferAttribute(new Float32Array(d),3,1));var E=THREE.UniformsUtils.clone(THREE.UniformsLib.lights);E.opacity={value:o?.5:1},E.isDebug={value:n?1:0};var w=new THREE.RawShaderMaterial({uniforms:E,vertexShader:i["default"],fragmentShader:u["default"],side:THREE.FrontSide,transparent:!!o,lights:!0}),y=new THREE.Mesh(g,w);return y.name="floors_isTrash:"+o+"_isDebug:"+n,y};t["default"]=c},function(e,t){e.exports="attribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\n\r\nattribute vec3 offset;\r\nattribute vec3 scale;\r\nattribute vec3 color;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    mat4 modelMat = mat4(\r\n        scale.x, 0., 0., 0.,\r\n        0., scale.y, 0., 0.,\r\n        0., 0., scale.z, 0.,\r\n        offset.x, offset.y, offset.z, 1.\r\n    );\r\n\tgl_Position = projectionMatrix * viewMatrix * modelMat * vec4(position, 1.);\r\n\r\n\tvNormal = mat3(viewMatrix * modelMat) * normal;\r\n\tvColor = color;\r\n    vUv = uv * vec2(scale.x, scale.z);\r\n}\r\n"},function(e,t){e.exports="precision mediump float;\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\n#include <common>\r\n#include <lights_pars>\r\n\r\nuniform float opacity;\r\nuniform float isDebug;\r\n\r\nvoid main() {\r\n\r\n    vec2 uv = mod(vUv, 1.) - 0.5;\r\n    float d = clamp(uv.x * uv.x + uv.y * uv.y, 0., 1.);\r\n\tvec3 c = vColor * (isDebug > 0.5 ? 1. : d * d);\r\n\r\n    #if NUM_DIR_LIGHTS > 0\r\n    vec3 light;\r\n\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n\t\tlight = max( dot(normalize(vNormal), directionalLights[i].direction), 0.0) * directionalLights[i].color * 0.5;\r\n\t\tc += light;\r\n\t}\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(c, opacity);\r\n}\r\n"},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),i=o(a),s=n(10),u=o(s),c=n(6),l=o(c),d=n(7),m=o(d),f=function h(e,t){var n=t.isDebug,o=t.config,a=t.isWall;r(this,h);for(var s=[],c=[],d=[],f=a?o.wallColor:n?o.tunnelDebugColor:o.floorTunnelColor,v=a?o.wallHeight:n?o.tunnelDebugHeight:o.tunnelHeight,p=a?v/2-.5:0,b=void 0,g=void 0,E=void 0,w=void 0,y=void 0,T=0;T<e.length;T+=4){b=e[T+2]-e[T]>e[T+3]-e[T+1],g=b?(e[T]+e[T+2])/2:e[T]+.5,w=b?e[T+2]-e[T]:1,E=b?e[T+1]+.5:(e[T+1]+e[T+3])/2,y=b?1:e[T+3]-e[T+1],s.push(g,p,E),c.push(w,v,y);var R=[Math.abs(Math.sin(157.21355*g)),Math.abs(Math.sin(157.21355*g*E))/3,Math.abs(Math.sin(157.21355*E))];d.push.apply(d,a&&n?R:f)}var H=new THREE.BoxBufferGeometry(1,1,1),P=new THREE.InstancedBufferGeometry;if(a||n)for(var M=0;M<H.attributes.position.array.length/3;M++)H.attributes.position.array[3*M+1]<0?H.attributes.uv.array[2*M+1]=0:H.attributes.uv.array[2*M+1]=1;P.addAttribute("position",H.attributes.position),P.addAttribute("normal",H.attributes.normal),P.addAttribute("uv",H.attributes.uv),P.setIndex(H.index),P.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(s),3,1)),P.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(c),3,1)),P.addAttribute("color",new THREE.InstancedBufferAttribute(new Float32Array(d),3,1));var x=THREE.UniformsUtils.clone(THREE.UniformsLib.lights);x.isDebug={value:n?1:0};var C=new THREE.RawShaderMaterial({uniforms:x,vertexShader:a||n?i["default"]:l["default"],fragmentShader:a||n?u["default"]:m["default"],side:THREE.FrontSide,transparent:!1,lights:!0}),D=new THREE.Mesh(P,C);return D.name=(a?"walls_isDebug:":"tunnels_isDebug")+n,D};t["default"]=f},function(e,t){e.exports="attribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\nattribute vec3 color;\r\n\r\nattribute vec3 offset;\r\nattribute vec3 scale;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    mat4 modelMat = mat4(\r\n        scale.x, 0., 0., 0.,\r\n        0., scale.y, 0., 0.,\r\n        0., 0., scale.z, 0.,\r\n        offset.x, offset.y, offset.z, 1.\r\n    );\r\n\tgl_Position = projectionMatrix * viewMatrix * modelMat * vec4(position, 1.);\r\n\r\n\tvNormal = mat3(viewMatrix * modelMat) * normal;\r\n    vColor = color;\r\n    vUv = uv;\r\n}\r\n"},function(e,t){e.exports="precision mediump float;\r\nvarying vec3 vNormal;\r\n\r\n#include <common>\r\n#include <lights_pars>\r\n\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec3 c = vColor * sqrt(vUv.y);\r\n\r\n    #if NUM_DIR_LIGHTS > 0\r\n    vec3 light;\r\n\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n\t\tlight = max( dot(normalize(vNormal), directionalLights[i].direction), 0.0) * directionalLights[i].color * 0.5;\r\n\t\tc += light;\r\n\t}\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(c, 1.0);\r\n}\r\n"},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=0,r=function a(e,t){n(this,a);var r=new THREE.Object3D;r.name="lines_container_"+o,o++;for(var i=new THREE.LineBasicMaterial({color:t}),s=0;s<e.length;s+=4){var u=new THREE.Geometry;u.vertices.push(new THREE.Vector3(e[s],1,e[s+1]),new THREE.Vector3(e[s+2],1,e[s+3]));var c=new THREE.Line(u,i);r.add(c)}return r};t["default"]=r},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={generationMode:{withWalls:!0,isDebug:!1},dungeonParams:{roomSizeDistribution:"normal",dungeonSize:10,roomSizeMean:9,roomSizeDeviation:.75,mainRoomThreshold:1.1,connectivity:.7,density:.6,fromDungeonId:!1,dungeonId:""},visParams:{floorHeight:1,tunnelHeight:1,wallHeight:4,floorTunnelColor:[1,1,1],wallColor:[.6,.6,.6],mainFloorDebugColor:[.6,.1,.1],attachedFloorDebugColor:[.1,.4,.04],trashFloorDebugColor:[.3,.3,.3],trashFloorY:-.9,tunnelDebugHeight:1.2,tunnelDebugColor:[.7,.7,.7]}};t["default"]=n},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(12),s=o(i),u=function(){function e(t){var n=this;r(this,e),this.dungeonVisualizer=t,this.dungeon=null,this.dungeonParams=s["default"].dungeonParams;var o=new dat.GUI({width:400});o.add(this.dungeonParams,"dungeonSize").min(1).max(120).step(1);var a=o.addFolder("Rooms");a.add(this.dungeonParams,"roomSizeDistribution",{normal:"normal",uniform:"uniform"}),a.add(this.dungeonParams,"roomSizeMean").min(5).max(30).step(1),a.add(this.dungeonParams,"roomSizeDeviation").min(.1).max(.9).step(.01),a.add(this.dungeonParams,"mainRoomThreshold").min(1).max(1.33).step(.01),o.add(this.dungeonParams,"connectivity").min(0).max(1).step(.01),o.add(this.dungeonParams,"density").min(0).max(1).step(.01),o.add(s["default"].generationMode,"withWalls").onChange(function(){n.resetDungeon(!0)}),o.add(s["default"].generationMode,"isDebug").onChange(function(){n.resetDungeon(!0)}),o.add(this.dungeonParams,"fromDungeonId"),o.add(this.dungeonParams,"dungeonId").onChange().listen();var i={ExportToFile:function(){n.exportDungeon(n.dungeon,n.dungeonParams.dungeonId)}};o.add(i,"ExportToFile");var u={Generate:function(){n.resetDungeon()}};o.add(u,"Generate")}return a(e,[{key:"generateNewDungeonId",value:function(){var e=(Math.random()+1).toString(36).substring(7,16),t=e+","+this.dungeonParams.dungeonSize+","+this.dungeonParams.roomSizeDistribution+","+this.dungeonParams.roomSizeMean+","+this.dungeonParams.roomSizeDeviation+","+this.dungeonParams.mainRoomThreshold+","+this.dungeonParams.connectivity+","+this.dungeonParams.density;return t}},{key:"resetDungeon",value:function(e){var t=e||this.dungeonParams.fromDungeonId?this.dungeonParams.dungeonId:this.generateNewDungeonId();this.dungeonParams.dungeonId=t;var n=window.dungeonizer.generateDungeonById(t,s["default"].generationMode.withWalls,s["default"].generationMode.isDebug);this.dungeon=n,this.dungeonVisualizer.makeDungeonVisual(this.dungeon,this.dungeonParams.dungeonId)}},{key:"exportDungeon",value:function(e,t){var n=JSON.stringify({dungeonId:t,dungeon:e},null,4);window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,1048576,function(e){e.root.getFile("dungeon_"+t+".bin",{create:!0},function(e){e.createWriter(function(t){var o=new Blob([n]);t.addEventListener("writeend",function(){location.href=e.toURL()},!1),t.write(o)},function(){})},function(){})},function(){})}}]),e}();t["default"]=u},function(e,t){"use strict";e.exports=function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl"],n=!1,o=0;o<t.length;o++)try{if(n=e.getContext(t[o]),n&&"function"==typeof n.getParameter)return!0}catch(r){console.log("Unable to initialize WebGL. Your browser may not support it.")}return!1}return!1}}])});