!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=n(2),a=o(r),s=n(16),c=o(s),l=n(17),u=function d(){function e(){var e=Math.floor(o.clientWidth*m),t=Math.floor(o.clientHeight*m);o.width===e&&o.height===t||(u.resize(e,t),o.width=e,o.height=t,s.resize(e,t)),h.viewport(0,0,h.drawingBufferWidth,h.drawingBufferHeight)}function t(){e(),s.update(f.getDelta()),requestAnimationFrame(t)}if(i(this,d),!l())return void(document.body.innerHTML="Unable to initialize WebGL. Your browser may not support it.");var n=new THREE.WebGLRenderer({antialias:!0,alpha:!0});if(n.extensions.get("ANGLE_instanced_arrays")===!1)return void(document.body.innerHTML="Unable to get ANGLE_instanced_arrays WebGL extension. Your browser may not support it.");var o=n.domElement;o.className="canvas";var r=document.getElementById("root");r.appendChild(o),r.style.backgroundColor="red";var s=new a["default"](n),u=new c["default"](s);u.resetDungeon();var h=n.getContext(),m=window.devicePixelRatio||1,f=new THREE.Clock;t()};window.app=new u},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(3),s=o(a),c=n(9),l=o(c),u=n(12),d=o(u),h=n(15),m=o(h),f=n(4),v=o(f),p=function(){function e(t){i(this,e),this.renderer=t,this.renderer.setClearColor(0,!1),this.renderer.setPixelRatio(window.devicePixelRatio||1);var n=this.renderer.getContext(),o=n.canvas.clientWidth/n.canvas.clientHeight;this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(60,o,v["default"].camera.near,v["default"].camera.far),this.controls=new s["default"](this.camera,this.renderer.domElement,this.scene),this.controls.resetCameraOrbit();var r=new THREE.DirectionalLight(7368816);r.position.set(10,20,10),this.scene.add(r);var a=new THREE.DirectionalLight(7368816);a.position.set(-30,20,10),this.scene.add(a)}return r(e,[{key:"createDungeonMesh",value:function(e,t){var n=Boolean(e.mstLines&&e.leftAliveLines&&e.delaunayTriangles&&e.trashRooms),o=Boolean(e.walls),i=new THREE.Object3D;i.name="Dungeon_"+t;var r=new l["default"](e.rooms,{isDebug:n,isTrashFloors:!1,config:v["default"].visParams});r.frustumCulled=!1,i.add(r);var a=new d["default"](e.tunnels,{isDebug:n,config:v["default"].visParams});if(a.frustumCulled=!1,i.add(a),o){var s=new d["default"](e.walls,{isDebug:n,config:v["default"].visParams,isWall:!0});s.frustumCulled=!1,i.add(s)}if(n){var c=new m["default"](e.delaunayTriangles,8947848);i.add(c);var u=new m["default"](e.mstLines,255);i.add(u);var h=new m["default"](e.leftAliveLines,16711680);i.add(h);var f=new l["default"](e.trashRooms,{isDebug:n,isTrashFloors:!0,config:v["default"].visParams});f.frustumCulled=!1,i.add(f)}return i}},{key:"update",value:function(e){this.controls.update(e),this.renderer.render(this.scene,this.camera)}},{key:"resize",value:function(e,t){var n=e/t;this.camera.aspect!==n&&(this.camera.aspect=n,this.camera.updateProjectionMatrix())}},{key:"dispose",value:function(){this.controls.dispose(),this.clearScene()}},{key:"makeDungeonVisual",value:function(e,t){this.clearScene();var n=this.createDungeonMesh(e,t);this.scene.add(n)}},{key:"clearScene",value:function(){for(var e=this.scene.children.length-1;e>=0;e--){var t=this.scene.children[e];if(t.name.includes("Dungeon")){for(var n=t.children.length-1;n>=0;n--){var o=t.children[n];if(o instanceof THREE.Mesh)o.material.dispose(),o.geometry.dispose();else for(var i=o.children.length-1;i>=0;i--){var r=o.children[i];r.material.dispose(),r.geometry.dispose(),r.parent.remove(r)}o.parent.remove(o)}t.parent.remove(t)}}}}]),e}();t["default"]=p},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(4),s=o(a),c=n(5),l=o(c);window.THREE=THREE,n(6),n(7);var u=n(8)(),d=void 0;try{d=new Event("disableWalker")}catch(h){d=document.createEvent("Event"),d.initEvent("disableWalker",!0,!0)}var m=void 0,f={height:1.6,moveForward:!1,moveLeft:!1,moveBackward:!1,moveRight:!1,speedModifier:1,shiftSpeedModifier:2,jump:!1,isJumping:!1,moveForwardBackMultiplier:1,moveLeftRightMultiplier:.9,mobileRotateHorizontalMult:.35,mobileRotateVerticalMult:.5,mobileLookLeftRight:0,mobileLookUpDown:0,velocity:new THREE.Vector3(0,0,0),raycaster:new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3(0,(-1),0),0,10),walkingSpeed:65,jumpStrength:8,gravity:30},v=new THREE.Vector3,p=new THREE.Vector3,b=new THREE.Vector3,E=function(e){switch(e.keyCode){case 38:case 87:f.moveForward=!0;break;case 37:case 65:f.moveLeft=!0;break;case 40:case 83:f.moveBackward=!0;break;case 39:case 68:f.moveRight=!0;break;case 16:f.speedModifier=f.shiftSpeedModifier;break;case 32:f.jump=!0;break;case 27:this.orbitControls.enabled||this.disableWalker()}},g=function(e){switch(e.keyCode){case 38:case 87:f.moveForward=!1;break;case 37:case 65:f.moveLeft=!1;break;case 40:case 83:f.moveBackward=!1;break;case 39:case 68:f.moveRight=!1;break;case 16:f.speedModifier=1;break;case 32:f.jump=!1}},y=function(){function e(t,n,o){i(this,e),m=this,this.camera=t,this.domElement=n,this.walkerEnabled=!1,this.isDesktop=u.desktop(),this.rotateOnMouseDown=!1,this.walkerTouchControls=null,this.orbitControls=new THREE.OrbitControls(t,n),this.orbitControls.enableDamping=!0,this.orbitControls.minDistance=1,this.orbitControls.maxDistance=1e3,this.orbitControls.rotateSpeed=.25,this.infoEl=document.createElement("div"),this.infoEl.className="buttonsRoot",this.infoEl.style.background="rgba(255,255,255,0.4)",this.isDesktop?this.infoEl.innerHTML="Controls: WASD / Space / Shift + mouse. Press Escape to exit.":(this.infoEl.style.width="60%",this.infoEl.style.height="20%",this.infoEl.style.right="0",this.infoEl.innerHTML="Controls: touch joystick to move, touch out of joystick to look around."),this.walkerControls=new THREE.PointerLockControls(t,n,this.isDesktop),this._controlsObject=this.walkerControls.getObject(),this._controlsObject.name="pointerLockObject",o.add(this._controlsObject),this.resetCameraOrbit(),this.navMesh=new THREE.Group,this.onKeyDown=E.bind(this),this.onKeyUp=g.bind(this)}return r(e,[{key:"enableWalker",value:function(e){this.createNavMesh(e.rooms,e.tunnels);var t=Math.floor(Math.random()*e.rooms.length);this.resetCameraWalker(),this._controlsObject.position.fromArray([e.rooms[t].x,6,e.rooms[t].y]),this._controlsObject.rotation.y=0,this._controlsObject.children[0].rotation.x=0,this.rotateOnMouseDown=!1,this.isDesktop?(this._addKeyboardListeners(),this._preparePointerLock()||(this.rotateOnMouseDown=!0,this._rotateOnMouseDownTouchStartEnable())):(this.walkerTouchControls||(this.walkerTouchControls=new l["default"](f,s["default"])),this.walkerTouchControls.enable(),this.walkerTouchControls.resetJoystickDiv()),document.body.appendChild(this.infoEl),this.orbitControls.enabled=!1,this.walkerControls.enabled=!this.rotateOnMouseDown}},{key:"disableWalker",value:function(){this.resetCameraOrbit(),this.isDesktop?(this._removeKeyboardListeners(),this._removePointerLock(),this.rotateOnMouseDown&&this._rotateOnMouseDownTouchStartDisable()):this.walkerTouchControls.disable(),document.body.removeChild(this.infoEl),this.orbitControls.enabled=!0,this.walkerControls.enabled=!1,this.clearNavMesh(),document.dispatchEvent(d)}},{key:"resetCameraOrbit",value:function(){this.camera.position.fromArray(s["default"].camera.cameraPos),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.camera.near=s["default"].camera.near,this.camera.far=s["default"].camera.far,this.camera.updateProjectionMatrix(),this._controlsObject.position.set(0,0,0),this._controlsObject.rotation.y=0,this._controlsObject.children[0].rotation.x=0}},{key:"resetCameraWalker",value:function(){this.camera.position.set(0,0,0),this.camera.rotation.set(0,0,0),this.camera.near=s["default"].camera.walkerNear,this.camera.far=s["default"].camera.walkerFar,this.camera.updateProjectionMatrix()}},{key:"update",value:function(e){if(this.orbitControls.enabled)this.orbitControls.update();else{var t=this._controlsObject;this.isDesktop||(t.rotation.y-=f.mobileLookLeftRight*f.mobileRotateHorizontalMult*e,t.children[0].rotation.x+=f.mobileLookUpDown*f.mobileRotateVerticalMult*e,t.children[0].rotation.x=Math.min(Math.max(t.children[0].rotation.x,-Math.PI/2),Math.PI/2),this.walkerTouchControls.applyInertia());var n=void 0;f.raycaster.ray.origin.copy(t.position);var o=[];o=f.raycaster.intersectObjects(this.navMesh.children,!1);var i=o.length>0;f.velocity.x-=10*f.velocity.x*e,f.velocity.z-=10*f.velocity.z*e,f.velocity.y-=f.gravity*e,f.moveForward&&(f.velocity.z-=f.walkingSpeed*f.speedModifier*f.moveForwardBackMultiplier*e),f.moveBackward&&(f.velocity.z+=f.walkingSpeed*f.speedModifier*f.moveForwardBackMultiplier*e),f.moveLeft&&(f.velocity.x-=f.walkingSpeed*f.speedModifier*f.moveLeftRightMultiplier*e),f.moveRight&&(f.velocity.x+=f.walkingSpeed*f.speedModifier*f.moveLeftRightMultiplier*e),f.jump&&!f.isJumping&&(f.velocity.y=f.jumpStrength,f.isJumping=!0),i&&(n=o[0],n.distance+f.velocity.y*e<=f.height&&(t.position.y=o[0].point.y+f.height,f.velocity.y=0,f.isJumping=!1)),t.translateY(f.velocity.y*e);var r=t.position.clone();t.translateX(f.velocity.x*e),t.translateZ(f.velocity.z*e),f.raycaster.ray.origin.copy(t.position),o=[],o=f.raycaster.intersectObjects(this.navMesh.children,!1);var a=o.length>0;if(i&&!a){var s=t.position.clone(),c=n.object.geometry.attributes.position.array;v.fromArray(c,3*n.face.a).applyMatrix4(n.object.matrixWorld),p.fromArray(c,3*n.face.b).applyMatrix4(n.object.matrixWorld),b.fromArray(c,3*n.face.c).applyMatrix4(n.object.matrixWorld);var l=new THREE.Vector3(0).add(v).add(p).add(b).divideScalar(3),u=this._linesIntersectsXZ(v,p,r,s);if(u.intersect||(u=this._linesIntersectsXZ(p,b,r,s),u.intersect||(u=this._linesIntersectsXZ(v,b,r,s))),u.intersect){var d=u.A,h=u.B,m=(new THREE.Vector3).subVectors(h,d),E=(new THREE.Vector3).subVectors(t.position,d).projectOnVector(m);E.add(d),E.add((new THREE.Vector3).subVectors(l,E).divideScalar(1e3)),E.y=r.y,t.position.copy(E)}else t.position.copy(r);f.raycaster.ray.origin.copy(t.position),o=[],o=f.raycaster.intersectObjects(this.navMesh.children,!1),o.length<1&&t.position.copy(r)}}}},{key:"_linesIntersectsXZ",value:function(e,t,n,o){var i=new THREE.Vector2(t.x-e.x,t.z-e.z),r=new THREE.Vector2(o.x-n.x,o.z-n.z),a=(-i.y*(e.x-n.x)+i.x*(e.z-n.z))/(-r.x*i.y+i.x*r.y),s=(r.x*(e.z-n.z)-r.y*(e.x-n.x))/(-r.x*i.y+i.x*r.y),c=a>=0&&a<=1&&s>=0&&s<=1;return{intersect:c,A:e,B:t}}},{key:"createNavMesh",value:function(e,t){for(var n=this.navMesh,o=new THREE.BoxBufferGeometry(1,1,1),i=void 0,r=void 0,a=void 0,c=void 0,l=void 0,u=void 0,d=0;d<e.length;d++){var h=new THREE.Mesh(o);h.scale.set(e[d].w-.04,s["default"].visParams.floorHeight,e[d].h-.04),h.position.set(e[d].x,0,e[d].y),n.add(h)}for(var m=0;m<t.length;m+=4)i=new THREE.Mesh(o),r=t[m+2]-t[m]>t[m+3]-t[m+1],a=r?(t[m]+t[m+2])/2:t[m]+.5,l=r?t[m+2]-t[m]-.04:.96,c=r?t[m+1]+.5:(t[m+1]+t[m+3])/2,u=r?.96:t[m+3]-t[m+1]-.04,i.scale.set(l,s["default"].visParams.tunnelHeight,u),i.position.set(a,0,c),n.add(i);n.updateMatrixWorld(!0)}},{key:"clearNavMesh",value:function(){for(var e=this.navMesh.children.length-1;e>=0;e--)this.navMesh.children[e].geometry.dispose(),this.navMesh.remove(this.navMesh.children[e])}},{key:"_rotateOnMouseDownTouchStartEnable",value:function(){this.domElement.addEventListener("mousedown",this._onMousePressTouchStart,!1),this.domElement.addEventListener("mouseup",this._onMouseReleaseTouchEnd,!1),this.domElement.addEventListener("mouseout",this._onMouseReleaseTouchEnd,!1),this.domElement.addEventListener("touchstart",this._onMousePressTouchStart,!1),this.domElement.addEventListener("touchend",this._onMouseReleaseTouchEnd,!1),this.domElement.addEventListener("touchcancel",this._onMouseReleaseTouchEnd,!1)}},{key:"_rotateOnMouseDownTouchStartDisable",value:function(){this.domElement.removeEventListener("mousedown",this._onMousePressTouchStart,!1),this.domElement.removeEventListener("mouseup",this._onMouseReleaseTouchEnd,!1),this.domElement.removeEventListener("mouseout",this._onMouseReleaseTouchEnd,!1),this.domElement.removeEventListener("touchstart",this._onMousePressTouchStart,!1),this.domElement.removeEventListener("touchend",this._onMouseReleaseTouchEnd,!1),this.domElement.removeEventListener("touchcancel",this._onMouseReleaseTouchEnd,!1)}},{key:"_onMousePressTouchStart",value:function(e){e.preventDefault(),e.changedTouches&&e.changedTouches.length&&!m.walkerControls.enabled&&(m.walkerControls.touchId=e.changedTouches[0].identifier,m.walkerControls.touchLastPos.x=e.changedTouches[0].clientX,m.walkerControls.touchLastPos.y=e.changedTouches[0].clientY),m.walkerControls.enabled=!0}},{key:"_onMouseReleaseTouchEnd",value:function(){m.walkerControls.enabled=!1}},{key:"_pointerlockchange",value:function(){var e=document.body;document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e||m.orbitControls.enabled||m.disableWalker()}},{key:"_pointerlockerror",value:function(){var e=document.body;e.innerHTML="PointerLock Error"}},{key:"_preparePointerLock",value:function(){var e=document.body,t=!1;return("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document)&&(document.addEventListener("pointerlockchange",this._pointerlockchange,!1),document.addEventListener("mozpointerlockchange",this._pointerlockchange,!1),document.addEventListener("webkitpointerlockchange",this._pointerlockchange,!1),document.addEventListener("pointerlockerror",this._pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this._pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this._pointerlockerror,!1),e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock(),t=!0),t}},{key:"_removePointerLock",value:function(){document.removeEventListener("pointerlockchange",this._pointerlockchange,!1),document.removeEventListener("mozpointerlockchange",this._pointerlockchange,!1),document.removeEventListener("webkitpointerlockchange",this._pointerlockchange,!1),document.removeEventListener("pointerlockerror",this._pointerlockerror,!1),document.removeEventListener("mozpointerlockerror",this._pointerlockerror,!1),document.removeEventListener("webkitpointerlockerror",this._pointerlockerror,!1)}},{key:"_addKeyboardListeners",value:function(){document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1)}},{key:"_removeKeyboardListeners",value:function(){document.removeEventListener("keydown",this.onKeyDown,!1),document.removeEventListener("keyup",this.onKeyUp,!1)}},{key:"dispose",value:function(){this.orbitControls.dispose(),this.walkerControls.dispose()}}]),e}();t["default"]=y},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={global:{repoUrl:"https://github.com/mlknz/Dungeonizer.js"},generationMode:{withWalls:!0,isDebug:!1},dungeonParams:{roomSizeDistribution:"normal",dungeonSize:10,roomSizeMean:9,roomSizeDeviation:.75,mainRoomThreshold:1.1,connectivity:.7,density:.6,fromDungeonId:!1,dungeonId:""},camera:{cameraPos:[-90,110,50],near:1,far:1400,walkerNear:.005,walkerFar:100},visParams:{floorHeight:1,tunnelHeight:1,wallHeight:4,floorTunnelColor:[1,1,1],wallColor:[.6,.6,.6],mainFloorDebugColor:[.6,.1,.1],attachedFloorDebugColor:[.1,.4,.04],trashFloorDebugColor:[.3,.3,.3],trashFloorY:-.9,tunnelDebugHeight:1.2,tunnelDebugColor:[.7,.7,.7],joystickReturnSpeed:15}};t["default"]=n},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=void 0,r=void 0,a=void 0,s=void 0,c=void 0,l=void 0,u=void 0,d=void 0,h=void 0,m=void 0,f=void 0,v=void 0,p=void 0,b=void 0,E=void 0,g=void 0,y=void 0,w=function(){function e(t,o){var i=this;n(this,e),this.walkerVars=t,this.joystickReturnSpeed=o.visParams.joystickReturnSpeed,this._createDivs(),this._applyStyles(),this.moveTouchId=null,this.lookTouchId=null,this.jumpTouchId=null,this.lastMoveTouchPos=new THREE.Vector2,this.lastLookTouchPos=new THREE.Vector2,this._back.addEventListener("touchstart",function(e){Number.isInteger(i.moveTouchId)||(i.moveTouchId=e.changedTouches[0].identifier,i._onMoveTouchChange(e.changedTouches[0]),i._back.style.opacity="0.8")}),this._lookJoystickCont.addEventListener("touchstart",function(e){Number.isInteger(i.lookTouchId)||(i.lookTouchId=e.changedTouches[0].identifier,i.lastLookTouchPos.set(e.changedTouches[0].screenX,e.changedTouches[0].screenY))}),document.addEventListener("touchmove",function(e){i._onTouchMove(e)}),document.addEventListener("touchend",function(e){i._onTouchEnd(e)}),document.addEventListener("touchcancel",function(e){i._onTouchEnd(e)}),this._jumpButtonCont.addEventListener("touchstart",function(e){i.jumpTouchId=e.changedTouches[0].identifier,i.walkerVars.jump=!0})}return o(e,[{key:"enable",value:function(){document.body.appendChild(this._moveJoystickCont),document.body.appendChild(this._lookJoystickCont),document.body.appendChild(this._jumpButtonCont)}},{key:"disable",value:function(){document.body.removeChild(this._moveJoystickCont),document.body.removeChild(this._lookJoystickCont),document.body.removeChild(this._jumpButtonCont)}},{key:"applyInertia",value:function(){this.walkerVars.mobileLookLeftRight/=2,this.walkerVars.mobileLookUpDown/=2,Number.isInteger(this.moveTouchId)||this._smoothResetJoystickDiv()}},{key:"_onTouchMove",value:function(e){e.preventDefault();for(var t=0;t<e.changedTouches.length;t++)e.changedTouches[t].identifier===this.moveTouchId?this._onMoveTouchChange(e.changedTouches[t]):e.changedTouches[t].identifier===this.lookTouchId&&this._onLookTouchChange(e.changedTouches[t])}},{key:"_onTouchEnd",value:function(e){for(var t=0;t<e.changedTouches.length;t++)e.changedTouches[t].identifier===this.moveTouchId?(this.moveTouchId=null,this._back.style.opacity="0.6",this.walkerVars.moveForward=!1,this.walkerVars.moveBackward=!1,this.walkerVars.moveRight=!1,this.walkerVars.moveLeft=!1):e.changedTouches[t].identifier===this.lookTouchId?this.lookTouchId=null:e.changedTouches[t].identifier===this.jumpTouchId&&(this.jumpTouchId=null,this.walkerVars.jump=!1)}},{key:"resetJoystickDiv",value:function(){this._front.style.marginLeft=this._back.clientWidth/2-this._front.clientWidth/2-1+"px",this._front.style.marginTop=this._back.clientHeight/2-this._front.clientHeight/2-1+"px"}},{key:"_smoothResetJoystickDiv",value:function(){i=this._back.clientWidth/2-this._front.clientWidth/2-1,r=this._back.clientHeight/2-this._front.clientHeight/2-1,a=this._front.offsetLeft,s=this._front.offsetTop,c=i-a,l=r-s,u=Math.sqrt(c*c+l*l),c/=u,l/=u,d=a+c*this.joystickReturnSpeed,h=s+l*this.joystickReturnSpeed,m=(d-i)*(d-i)+(h-r)*(h-r),m<this.joystickReturnSpeed*this.joystickReturnSpeed&&(d=i,h=r),this._front.style.marginLeft=d+"px",this._front.style.marginTop=h+"px"}},{key:"_onMoveTouchChange",value:function(e){p=this._moveJoystickCont.offsetLeft+this._back.clientWidth/2,b=this._moveJoystickCont.offsetTop+this._back.clientHeight/2,f=e.clientX-p,v=e.clientY-b,E=this._back.clientWidth/2-this._front.clientWidth/2,g=this._back.clientHeight/2-this._front.clientHeight/2,y=Math.sqrt(f*f+v*v)/(this._moveJoystickCont.clientWidth/2),y>1&&(f/=y,v/=y),this._front.style.marginLeft=E+f+"px",this._front.style.marginTop=g+v+"px",f/=this._moveJoystickCont.clientWidth/2,v/=this._moveJoystickCont.clientWidth/2,this.walkerVars.moveForward=v<0,this.walkerVars.moveBackward=v>0,this.walkerVars.moveRight=f>0,this.walkerVars.moveLeft=f<0,this.walkerVars.moveForwardBackMultiplier=Math.abs(v),this.walkerVars.moveLeftRightMultiplier=Math.abs(f)}},{key:"_onLookTouchChange",value:function(e){f=e.screenX-this.lastLookTouchPos.x,v=-(e.screenY-this.lastLookTouchPos.y),this.walkerVars.mobileLookLeftRight=f,this.walkerVars.mobileLookUpDown=v,this.lastLookTouchPos.set(e.screenX,e.screenY)}},{key:"_createDivs",value:function(){this._moveJoystickCont=document.createElement("div.moveJoystickCont"),this._back=document.createElement("div.moveJoystickBack"),this._front=document.createElement("div.moveJoystickFront"),this._moveJoystickCont.appendChild(this._back),this._back.appendChild(this._front),this._lookJoystickCont=document.createElement("div.lookJoystickCont"),this._jumpButtonCont=document.createElement("div.jumpButtonCont"),this._jumpButton=document.createElement("div.jumpButton"),this._jumpButton.innerHTML="Jump",this._jumpButtonCont.appendChild(this._jumpButton)}},{key:"_applyStyles",value:function(){var e=this._moveJoystickCont,t=this._back,n=this._front,o=this._lookJoystickCont;e.style.position="absolute",e.style.left="5vw",e.style.bottom="10vh",e.style.width="25vw",e.style.height="25vw",e.style.zIndex="1",t.style.width="100%",t.style.height="100%",t.style.display="table",t.style.backgroundColor="#333333",t.style.opacity="0.6",t.style.borderRadius="50%",n.style.width="50%",n.style.height="50%",n.style.display="block",n.style.backgroundColor="#000000",n.style.borderRadius="50%",n.style.borderStyle="dashed",n.style.borderColor="white",o.style.height="80%",o.style.position="absolute",o.style.width="100%",o.style.bottom="0",o.style.right="0",this._jumpButtonCont.className="exitWalkerMobile",this._jumpButton.className="exitWalkerMobileButton",this._jumpButtonCont.style.display="table",this._jumpButtonCont.style.right="0",this._jumpButtonCont.style.left="auto"}}]),e}();t["default"]=w},function(e,t){THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*j.autoRotateSpeed}function o(){return Math.pow(.95,j.zoomSpeed)}function i(e){N.theta-=e}function r(e){N.phi-=e}function a(e){j.object instanceof THREE.PerspectiveCamera?F/=e:j.object instanceof THREE.OrthographicCamera?(j.object.zoom=Math.max(j.minZoom,Math.min(j.maxZoom,j.object.zoom*e)),j.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),j.enableZoom=!1)}function s(e){j.object instanceof THREE.PerspectiveCamera?F*=e:j.object instanceof THREE.OrthographicCamera?(j.object.zoom=Math.max(j.minZoom,Math.min(j.maxZoom,j.object.zoom/e)),j.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),j.enableZoom=!1)}function c(e){Y.set(e.clientX,e.clientY)}function l(e){q.set(e.clientX,e.clientY)}function u(e){Z.set(e.clientX,e.clientY)}function d(e){J.set(e.clientX,e.clientY),X.subVectors(J,Y);var t=j.domElement===document?j.domElement.body:j.domElement;i(2*Math.PI*X.x/t.clientWidth*j.rotateSpeed),r(2*Math.PI*X.y/t.clientHeight*j.rotateSpeed),Y.copy(J),j.update()}function h(e){Q.set(e.clientX,e.clientY),$.subVectors(Q,q),$.y>0?a(o()):$.y<0&&s(o()),q.copy(Q),j.update()}function m(e){G.set(e.clientX,e.clientY),K.subVectors(G,Z),ne(K.x,K.y),Z.copy(G),j.update()}function f(e){}function v(e){e.deltaY<0?s(o()):e.deltaY>0&&a(o()),j.update()}function p(e){switch(e.keyCode){case j.keys.UP:ne(0,j.keyPanSpeed),j.update();break;case j.keys.BOTTOM:ne(0,-j.keyPanSpeed),j.update();break;case j.keys.LEFT:ne(j.keyPanSpeed,0),j.update();break;case j.keys.RIGHT:ne(-j.keyPanSpeed,0),j.update()}}function b(e){Y.set(e.touches[0].pageX,e.touches[0].pageY)}function E(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);q.set(0,o)}function g(e){Z.set(e.touches[0].pageX,e.touches[0].pageY)}function y(e){J.set(e.touches[0].pageX,e.touches[0].pageY),X.subVectors(J,Y);var t=j.domElement===document?j.domElement.body:j.domElement;i(2*Math.PI*X.x/t.clientWidth*j.rotateSpeed),r(2*Math.PI*X.y/t.clientHeight*j.rotateSpeed),Y.copy(J),j.update()}function w(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);Q.set(0,i),$.subVectors(Q,q),$.y>0?s(o()):$.y<0&&a(o()),q.copy(Q),j.update()}function k(e){G.set(e.touches[0].pageX,e.touches[0].pageY),K.subVectors(G,Z),ne(K.x,K.y),Z.copy(G),j.update()}function T(e){}function R(e){if(j.enabled!==!1){if(e.preventDefault(),e.button===j.mouseButtons.ORBIT){if(j.enableRotate===!1)return;c(e),A=z.ROTATE}else if(e.button===j.mouseButtons.ZOOM){if(j.enableZoom===!1)return;l(e),A=z.DOLLY}else if(e.button===j.mouseButtons.PAN){if(j.enablePan===!1)return;u(e),A=z.PAN}A!==z.NONE&&(document.addEventListener("mousemove",M,!1),document.addEventListener("mouseup",_,!1),j.dispatchEvent(S))}}function M(e){if(j.enabled!==!1)if(e.preventDefault(),A===z.ROTATE){if(j.enableRotate===!1)return;d(e)}else if(A===z.DOLLY){if(j.enableZoom===!1)return;h(e)}else if(A===z.PAN){if(j.enablePan===!1)return;m(e)}}function _(e){j.enabled!==!1&&(f(e),document.removeEventListener("mousemove",M,!1),document.removeEventListener("mouseup",_,!1),j.dispatchEvent(I),A=z.NONE)}function C(e){j.enabled===!1||j.enableZoom===!1||A!==z.NONE&&A!==z.ROTATE||(e.preventDefault(),e.stopPropagation(),v(e),j.dispatchEvent(S),j.dispatchEvent(I))}function L(e){j.enabled!==!1&&j.enableKeys!==!1&&j.enablePan!==!1&&p(e)}function x(e){if(j.enabled!==!1){switch(e.touches.length){case 1:if(j.enableRotate===!1)return;b(e),A=z.TOUCH_ROTATE;break;case 2:if(j.enableZoom===!1)return;E(e),A=z.TOUCH_DOLLY;break;case 3:if(j.enablePan===!1)return;g(e),A=z.TOUCH_PAN;break;default:A=z.NONE}A!==z.NONE&&j.dispatchEvent(S)}}function H(e){if(j.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(j.enableRotate===!1)return;if(A!==z.TOUCH_ROTATE)return;y(e);break;case 2:if(j.enableZoom===!1)return;if(A!==z.TOUCH_DOLLY)return;w(e);break;case 3:if(j.enablePan===!1)return;if(A!==z.TOUCH_PAN)return;k(e);break;default:A=z.NONE}}function P(e){j.enabled!==!1&&(T(e),j.dispatchEvent(I),A=z.NONE)}function D(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return B.phi},this.getAzimuthalAngle=function(){return B.theta},this.reset=function(){j.target.copy(j.target0),j.object.position.copy(j.position0),j.object.zoom=j.zoom0,j.object.updateProjectionMatrix(),j.dispatchEvent(O),j.update(),A=z.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),r=o.clone().inverse(),a=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=j.object.position;return t.copy(e).sub(j.target),t.applyQuaternion(o),B.setFromVector3(t),j.autoRotate&&A===z.NONE&&i(n()),B.theta+=N.theta,B.phi+=N.phi,B.theta=Math.max(j.minAzimuthAngle,Math.min(j.maxAzimuthAngle,B.theta)),B.phi=Math.max(j.minPolarAngle,Math.min(j.maxPolarAngle,B.phi)),B.makeSafe(),B.radius*=F,B.radius=Math.max(j.minDistance,Math.min(j.maxDistance,B.radius)),j.target.add(U),t.setFromSpherical(B),t.applyQuaternion(r),e.copy(j.target).add(t),j.object.lookAt(j.target),j.enableDamping===!0?(N.theta*=1-j.dampingFactor,N.phi*=1-j.dampingFactor):N.set(0,0,0),F=1,U.set(0,0,0),!!(W||a.distanceToSquared(j.object.position)>V||8*(1-s.dot(j.object.quaternion))>V)&&(j.dispatchEvent(O),a.copy(j.object.position),s.copy(j.object.quaternion),W=!1,!0)}}(),this.dispose=function(){j.domElement.removeEventListener("contextmenu",D,!1),j.domElement.removeEventListener("mousedown",R,!1),j.domElement.removeEventListener("wheel",C,!1),j.domElement.removeEventListener("touchstart",x,!1),j.domElement.removeEventListener("touchend",P,!1),j.domElement.removeEventListener("touchmove",H,!1),document.removeEventListener("mousemove",M,!1),document.removeEventListener("mouseup",_,!1),window.removeEventListener("keydown",L,!1)};var j=this,O={type:"change"},S={type:"start"},I={type:"end"},z={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},A=z.NONE,V=1e-6,B=new THREE.Spherical,N=new THREE.Spherical,F=1,U=new THREE.Vector3,W=!1,Y=new THREE.Vector2,J=new THREE.Vector2,X=new THREE.Vector2,Z=new THREE.Vector2,G=new THREE.Vector2,K=new THREE.Vector2,q=new THREE.Vector2,Q=new THREE.Vector2,$=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),U.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),U.add(e)}}(),ne=function(){var e=new THREE.Vector3;return function(t,n){var o=j.domElement===document?j.domElement.body:j.domElement;if(j.object instanceof THREE.PerspectiveCamera){var i=j.object.position;e.copy(i).sub(j.target);var r=e.length();r*=Math.tan(j.object.fov/2*Math.PI/180),ee(2*t*r/o.clientHeight,j.object.matrix),te(2*n*r/o.clientHeight,j.object.matrix)}else j.object instanceof THREE.OrthographicCamera?(ee(t*(j.object.right-j.object.left)/j.object.zoom/o.clientWidth,j.object.matrix),te(n*(j.object.top-j.object.bottom)/j.object.zoom/o.clientHeight,j.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),j.enablePan=!1)}}();j.domElement.addEventListener("contextmenu",D,!1),j.domElement.addEventListener("mousedown",R,!1),j.domElement.addEventListener("wheel",C,!1),j.domElement.addEventListener("touchstart",x,!1),j.domElement.addEventListener("touchend",P,!1),j.domElement.addEventListener("touchmove",H,!1),window.addEventListener("keydown",L,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),
!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}})},function(e,t){"use strict";THREE.PointerLockControls=function(e,t,n){var o=this;o.domElement=void 0!==t?t:document,e.rotation.set(0,0,0);var i=new THREE.Object3D;i.add(e);var r=new THREE.Object3D;r.position.y=10,r.add(i);var a=Math.PI/2,s=function(e){if(o.enabled!==!1){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;r.rotation.y-=.002*t,i.rotation.x-=.002*n,i.rotation.x=Math.max(-a,Math.min(a,i.rotation.x))}},c=function(e){if(o.enabled!==!1){var t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,s=t-o.touchLastPos.x||0,c=n-o.touchLastPos.y||0;o.touchLastPos.x=t,o.touchLastPos.y=n,r.rotation.y-=.002*s,i.rotation.x-=.002*c,i.rotation.x=Math.max(-a,Math.min(a,i.rotation.x))}};this.dispose=function(){document.removeEventListener("mousemove",s,!1),n&&this.domElement.removeEventListener("touchmove",c,!1)},document.addEventListener("mousemove",s,!1),n&&this.domElement.addEventListener("touchmove",c,!1),this.enabled=!1,this.touchId=null,this.touchLastPos={x:null,y:null},this.getObject=function(){return r},this.getDirection=function(){var e=new THREE.Vector3(0,0,(-1)),t=new THREE.Euler(0,0,0,"YXZ");return function(n){return t.set(i.rotation.x,r.rotation.y,0),n.copy(e).applyEuler(t),n}}()}},function(e,t,n){var o,i;!function(t){"use strict";var n=function(e,t){function n(t){return e.indexOf(t)!==-1}function o(e){var t;return t=new RegExp(e,"i"),c.className.match(t)}function i(e){o(e)||(c.className+=" "+e)}function r(e){o(e)&&(c.className=c.className.replace(e,""))}function a(t){var n=e.match(t);return n&&n.length>1&&n[1]||""}var s={},c=t||window.document.documentElement;e=(e||window.navigator.userAgent).toLowerCase(),s.ios=function(){return s.iphone()||s.ipod()||s.ipad()},s.iphone=function(){return n("iphone")},s.ipod=function(){return n("ipod")},s.ipad=function(){return n("ipad")},s.android=function(){return n("android")},s.androidPhone=function(){return s.android()&&n("mobile")},s.androidTablet=function(){return s.android()&&!n("mobile")},s.blackberry=function(){return n("blackberry")||n("bb10")||n("rim")},s.blackberryPhone=function(){return s.blackberry()&&!n("tablet")},s.blackberryTablet=function(){return s.blackberry()&&n("tablet")},s.windows=function(){return n("windows")},s.windowsPhone=function(){return s.windows()&&n("phone")},s.windowsTablet=function(){return s.windows()&&n("touch")&&!s.windowsPhone()},s.fxos=function(){return(n("(mobile;")||n("(tablet;"))&&n("; rv:")},s.fxosPhone=function(){return s.fxos()&&n("mobile")},s.fxosTablet=function(){return s.fxos()&&n("tablet")},s.meego=function(){return n("meego")},s.cordova=function(){return window.cordova&&"file:"===location.protocol},s.nodeWebkit=function(){return"object"==typeof window.process},s.bada=function(){return n("bada")},s.mobile=function(){return s.androidPhone()||s.iphone()||s.ipod()||s.windowsPhone()||s.blackberryPhone()||s.fxosPhone()||s.meego()},s.tablet=function(){return s.ipad()||s.androidTablet()||s.blackberryTablet()||s.windowsTablet()||s.fxosTablet()},s.desktop=function(){return!s.tablet()&&!s.mobile()},s.portrait=function(){return window.innerHeight/window.innerWidth>1},s.landscape=function(){return window.innerHeight/window.innerWidth<1},s.standAlone=function(){return window.navigator.standalone===!0},s.addClasses=function(){s._hasAddClasses||(s._hasAddClasses=!0,s.ios()?s.ipad()?i("ios ipad tablet"):s.iphone()?i("ios iphone mobile"):s.ipod()&&i("ios ipod mobile"):i(s.android()?s.androidTablet()?"android tablet":"android mobile":s.blackberry()?s.blackberryTablet()?"blackberry tablet":"blackberry mobile":s.windows()?s.windowsTablet()?"windows tablet":s.windowsPhone()?"windows mobile":"desktop":s.fxos()?s.fxosTablet()?"fxos tablet":"fxos mobile":s.meego()?"meego mobile":s.nodeWebkit()?"node-webkit":"desktop"),s.cordova()&&i("cordova"),s.standAlone()&&i("standalone"))};var l="";return s.ios()?(l=a(/os (\d+([_\s]\d+)*) like mac os x/i),l=l.replace(/[_\s]/g,".")):s.android()?l=a(/android[ \/-](\d+(\.\d+)*)/i):s.windowsPhone()?l=a(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):s.blackberry()?l=a(/rim\stablet\sos\s(\d+(\.\d+)*)/i):s.bada()&&(l=a(/bada\/(\d+(\.\d+)*)/i)),l&&(s.osversion=l),s.addOrientationClasses=function(){if(!s.hasOrientationListener){s.hasOrientationListener=!0;var e=function(){return s.landscape()?(r("portrait"),i("landscape")):(r("landscape"),i("portrait"))},t="onorientationchange"in window?"orientationchange":"resize";window.addEventListener?window.addEventListener(t,e,!1):window.attachEvent?window.attachEvent(t,e):window[t]=e,e()}},s};"undefined"!=typeof e&&e.exports?e.exports=n:(o=[],i=function(){return n}.apply(t,o),!(void 0!==i&&(e.exports=i)))}(this)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),a=o(r),s=n(11),c=o(s),l=function u(e,t){var n=t.isDebug,o=t.isTrashFloors,r=t.config;i(this,u);for(var s=[],l=[],d=[],h=n?r.mainFloorDebugColor:r.floorTunnelColor,m=r.attachedFloorDebugColor,f=r.trashFloorDebugColor,v=o?r.trashFloorY:0,p=0;p<e.length;p++)s.push(e[p].x,v,e[p].y),l.push(e[p].w,r.floorHeight,e[p].h),d.push.apply(d,o?f:e[p].isAttached?m:h);var b=new THREE.BoxBufferGeometry(1,1,1),E=new THREE.InstancedBufferGeometry;E.addAttribute("position",b.attributes.position),E.addAttribute("normal",b.attributes.normal),E.addAttribute("uv",b.attributes.uv),E.setIndex(b.index),E.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(s),3,1)),E.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(l),3,1)),E.addAttribute("color",new THREE.InstancedBufferAttribute(new Float32Array(d),3,1));var g=THREE.UniformsUtils.clone(THREE.UniformsLib.lights);g.opacity={value:o?.5:1},g.isDebug={value:n?1:0};var y=new THREE.RawShaderMaterial({uniforms:g,vertexShader:a["default"],fragmentShader:c["default"],side:THREE.FrontSide,transparent:!!o,lights:!0}),w=new THREE.Mesh(E,y);return w.name="floors_isTrash:"+o+"_isDebug:"+n,w};t["default"]=l},function(e,t){e.exports="attribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\n\r\nattribute vec3 offset;\r\nattribute vec3 scale;\r\nattribute vec3 color;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    mat4 modelMat = mat4(\r\n        scale.x, 0., 0., 0.,\r\n        0., scale.y, 0., 0.,\r\n        0., 0., scale.z, 0.,\r\n        offset.x, offset.y, offset.z, 1.\r\n    );\r\n\tgl_Position = projectionMatrix * viewMatrix * modelMat * vec4(position, 1.);\r\n\r\n\tvNormal = mat3(viewMatrix * modelMat) * normal;\r\n\tvColor = color;\r\n    vUv = uv * vec2(scale.x, scale.z);\r\n}\r\n"},function(e,t){e.exports="precision mediump float;\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\n#include <common>\r\n#include <lights_pars>\r\n\r\nuniform float opacity;\r\nuniform float isDebug;\r\n\r\nvoid main() {\r\n\r\n    vec2 uv = mod(vUv, 1.) - 0.5;\r\n    float d = clamp(uv.x * uv.x + uv.y * uv.y, 0., 1.);\r\n\tvec3 c = vColor * (isDebug > 0.5 ? 1. : d * d);\r\n\r\n    #if NUM_DIR_LIGHTS > 0\r\n    vec3 light;\r\n\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n\t\tlight = max( dot(normalize(vNormal), directionalLights[i].direction), 0.0) * directionalLights[i].color * 0.5;\r\n\t\tc += light;\r\n\t}\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(c, opacity);\r\n}\r\n"},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),a=o(r),s=n(14),c=o(s),l=n(10),u=o(l),d=n(11),h=o(d),m=function f(e,t){var n=t.isDebug,o=t.config,r=t.isWall;i(this,f);for(var s=[],l=[],d=[],m=r?o.wallColor:n?o.tunnelDebugColor:o.floorTunnelColor,v=r?o.wallHeight:n?o.tunnelDebugHeight:o.tunnelHeight,p=r?v/2-.5:0,b=void 0,E=void 0,g=void 0,y=void 0,w=void 0,k=0;k<e.length;k+=4){b=e[k+2]-e[k]>e[k+3]-e[k+1],E=b?(e[k]+e[k+2])/2:e[k]+.5,y=b?e[k+2]-e[k]:1,g=b?e[k+1]+.5:(e[k+1]+e[k+3])/2,w=b?1:e[k+3]-e[k+1],s.push(E,p,g),l.push(y,v,w);var T=[Math.abs(Math.sin(157.21355*E)),Math.abs(Math.sin(157.21355*E*g))/3,Math.abs(Math.sin(157.21355*g))];d.push.apply(d,r&&n?T:m)}var R=new THREE.BoxBufferGeometry(1,1,1),M=new THREE.InstancedBufferGeometry;if(r||n)for(var _=0;_<R.attributes.position.array.length/3;_++)R.attributes.position.array[3*_+1]<0?R.attributes.uv.array[2*_+1]=0:R.attributes.uv.array[2*_+1]=1;M.addAttribute("position",R.attributes.position),M.addAttribute("normal",R.attributes.normal),M.addAttribute("uv",R.attributes.uv),M.setIndex(R.index),M.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(s),3,1)),M.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(l),3,1)),M.addAttribute("color",new THREE.InstancedBufferAttribute(new Float32Array(d),3,1));var C=THREE.UniformsUtils.clone(THREE.UniformsLib.lights);C.isDebug={value:n?1:0};var L=new THREE.RawShaderMaterial({uniforms:C,vertexShader:r||n?a["default"]:u["default"],fragmentShader:r||n?c["default"]:h["default"],side:THREE.FrontSide,transparent:!1,lights:!0}),x=new THREE.Mesh(M,L);return x.name=(r?"walls_isDebug:":"tunnels_isDebug")+n,x};t["default"]=m},function(e,t){e.exports="attribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\nattribute vec3 color;\r\n\r\nattribute vec3 offset;\r\nattribute vec3 scale;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    mat4 modelMat = mat4(\r\n        scale.x, 0., 0., 0.,\r\n        0., scale.y, 0., 0.,\r\n        0., 0., scale.z, 0.,\r\n        offset.x, offset.y, offset.z, 1.\r\n    );\r\n\tgl_Position = projectionMatrix * viewMatrix * modelMat * vec4(position, 1.);\r\n\r\n\tvNormal = mat3(viewMatrix * modelMat) * normal;\r\n    vColor = color;\r\n    vUv = uv;\r\n}\r\n"},function(e,t){e.exports="precision mediump float;\r\nvarying vec3 vNormal;\r\n\r\n#include <common>\r\n#include <lights_pars>\r\n\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec3 c = vColor * sqrt(vUv.y);\r\n\r\n    #if NUM_DIR_LIGHTS > 0\r\n    vec3 light;\r\n\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n\t\tlight = max( dot(normalize(vNormal), directionalLights[i].direction), 0.0) * directionalLights[i].color * 0.5;\r\n\t\tc += light;\r\n\t}\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(c, 1.0);\r\n}\r\n"},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=0,i=function r(e,t){n(this,r);var i=new THREE.Object3D;i.name="lines_container_"+o,o++;for(var a=new THREE.LineBasicMaterial({color:t}),s=0;s<e.length;s+=4){var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(e[s],1,e[s+1]),new THREE.Vector3(e[s+2],1,e[s+3]));var l=new THREE.Line(c,a);i.add(l)}return i};t["default"]=i},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(4),s=o(a),c=n(8)(),l=function(){function e(t){var n=this;i(this,e),this.dungeonVisualizer=t,this.dungeon=null,this.dungeonParams=s["default"].dungeonParams,this.isDesktop=c.desktop(),this.buttonsContainer=document.getElementById("buttonsRoot"),this.mobileExitButton=document.getElementById("exitWalkerMobile");var o=new dat.GUI({width:300});this.gui=o,o.add(this.dungeonParams,"dungeonSize").min(1).max(100).step(1).name("Dungeon Size");var r=o.addFolder("Rooms");r.add(this.dungeonParams,"roomSizeDistribution",{normal:"normal",uniform:"uniform"}),r.add(this.dungeonParams,"roomSizeMean").min(5).max(30).step(1),r.add(this.dungeonParams,"roomSizeDeviation").min(.1).max(.9).step(.01),r.add(this.dungeonParams,"mainRoomThreshold").min(1).max(1.33).step(.01),o.add(this.dungeonParams,"connectivity").min(0).max(1).step(.01).name("Connectivity"),o.add(this.dungeonParams,"density").min(0).max(1).step(.01).name("Density"),o.add(s["default"].generationMode,"withWalls").name("Draw Walls").onChange(function(){n.resetDungeon(!0)}),o.add(s["default"].generationMode,"isDebug").name("Debug Mode").onChange(function(){n.resetDungeon(!0)}),o.add(this.dungeonParams,"fromDungeonId").name("From Dungeon ID"),o.add(this.dungeonParams,"dungeonId").name("Dungeon ID").onChange().listen();var a={exportToFile:function(){n.exportDungeon(n.dungeon,n.dungeonParams.dungeonId)}};o.add(a,"exportToFile").name("Export to File");var l={jumpToSource:function(){window.open(s["default"].global.repoUrl,"_blank")}};o.add(l,"jumpToSource").name("Go to Source Code"),this.isDesktop||o.close();var u=document.getElementById("generateButton");u.addEventListener("click",function(){n.resetDungeon()});var d=document.getElementById("walkerButton");d.addEventListener("click",function(){n.enableWalker()}),this.mobileExitButton.addEventListener("click",function(){n.dungeonVisualizer.controls.disableWalker()}),this.buttonsRoot=document.getElementById("buttonsRoot"),document.addEventListener("disableWalker",function(){n.buttonsRoot.style.display="",n.mobileExitButton.style.display="none",n.isDesktop&&o.open()})}return r(e,[{key:"resize",value:function(e,t){!this.isDesktop&&this.buttonsContainer&&(e>t?(this.buttonsContainer.style.width="50%",this.buttonsContainer.style.right="25%"):(this.buttonsContainer.style.width="100%",this.buttonsContainer.style.right="0"))}},{key:"generateNewDungeonId",value:function(){var e=(Math.random()+1).toString(36).substring(7,16),t=e+","+this.dungeonParams.dungeonSize+","+this.dungeonParams.roomSizeDistribution+","+this.dungeonParams.roomSizeMean+","+this.dungeonParams.roomSizeDeviation+","+this.dungeonParams.mainRoomThreshold+","+this.dungeonParams.connectivity+","+this.dungeonParams.density;return t}},{key:"resetDungeon",value:function(e){var t=e||this.dungeonParams.fromDungeonId?this.dungeonParams.dungeonId:this.generateNewDungeonId();this.dungeonParams.dungeonId=t;var n=window.dungeonizer.generateDungeonById(t,s["default"].generationMode.withWalls,s["default"].generationMode.isDebug);this.dungeon=n,this.dungeonVisualizer.makeDungeonVisual(this.dungeon,this.dungeonParams.dungeonId)}},{key:"enableWalker",value:function(){this.dungeonVisualizer.controls.enableWalker(this.dungeon),this.isDesktop||(this.mobileExitButton.style.display="table"),this.gui.close(),this.buttonsRoot.style.display="none"}},{key:"exportDungeon",value:function(e,t){var n=JSON.stringify({dungeonId:t,dungeon:e},null,4);window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,1048576,function(e){e.root.getFile("dungeon_"+t+".bin",{create:!0},function(e){e.createWriter(function(t){var o=new Blob([n]);t.addEventListener("writeend",function(){location.href=e.toURL()},!1),t.write(o)},function(){})},function(){})},function(){})}}]),e}();t["default"]=l},function(e,t){"use strict";e.exports=function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl"],n=!1,o=0;o<t.length;o++)try{if(n=e.getContext(t[o]),n&&"function"==typeof n.getParameter)return!0}catch(i){console.log("Unable to initialize WebGL. Your browser may not support it.")}return!1}return!1}}])});