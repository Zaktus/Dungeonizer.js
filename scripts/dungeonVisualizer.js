!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(2),a=o(i),s=n(14),c=o(s),l=n(16),u=function d(){function e(){var e=o.clientWidth,t=o.clientHeight;o.width===e&&o.height===t||(o.width=e*h,o.height=t*h,s.resize(e,t),m.viewport(0,0,m.drawingBufferWidth,m.drawingBufferHeight))}function t(){e(),s.update(f.getDelta()),requestAnimationFrame(t)}if(r(this,d),!l())return void(document.body.innerHTML="Unable to initialize WebGL. Your browser may not support it.");var n=new THREE.WebGLRenderer({antialias:!0,alpha:!0});if(n.extensions.get("ANGLE_instanced_arrays")===!1)return void(document.body.innerHTML="Unable to get ANGLE_instanced_arrays WebGL extension. Your browser may not support it.");var o=n.domElement;o.className="canvas";var i=document.getElementById("root");i.appendChild(o),i.style.backgroundColor="red";var s=new a["default"](n),u=new c["default"](s);u.resetDungeon();var m=n.getContext(),h=window.devicePixelRatio||1,f=new THREE.Clock;t()};window.app=new u},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(3),s=o(a),c=n(7),l=o(c),u=n(10),d=o(u),m=n(13),h=o(m),f=n(4),v=o(f),b=function(){function e(t){r(this,e),this.renderer=t,this.renderer.setClearColor(0,!1),this.renderer.setPixelRatio(window.devicePixelRatio||1);var n=this.renderer.getContext(),o=n.canvas.clientWidth/n.canvas.clientHeight;this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(60,o,v["default"].camera.near,v["default"].camera.far),this.controls=new s["default"](this.camera,this.renderer.domElement,this.scene),this.controls.resetCameraOrbit();var i=new THREE.DirectionalLight(7368816);i.position.set(10,20,10),this.scene.add(i);var a=new THREE.DirectionalLight(7368816);a.position.set(-30,20,10),this.scene.add(a)}return i(e,[{key:"createDungeonMesh",value:function(e,t){var n=Boolean(e.mstLines&&e.leftAliveLines&&e.delaunayTriangles&&e.trashRooms),o=Boolean(e.walls),r=new THREE.Object3D;r.name="Dungeon_"+t;var i=new l["default"](e.rooms,{isDebug:n,isTrashFloors:!1,config:v["default"].visParams});i.frustumCulled=!1,r.add(i);var a=new d["default"](e.tunnels,{isDebug:n,config:v["default"].visParams});if(a.frustumCulled=!1,r.add(a),o){var s=new d["default"](e.walls,{isDebug:n,config:v["default"].visParams,isWall:!0});s.frustumCulled=!1,r.add(s)}if(n){var c=new h["default"](e.delaunayTriangles,8947848);r.add(c);var u=new h["default"](e.mstLines,255);r.add(u);var m=new h["default"](e.leftAliveLines,16711680);r.add(m);var f=new l["default"](e.trashRooms,{isDebug:n,isTrashFloors:!0,config:v["default"].visParams});f.frustumCulled=!1,r.add(f)}return r}},{key:"update",value:function(e){this.controls.update(e),this.renderer.render(this.scene,this.camera)}},{key:"resize",value:function(e,t){var n=e/t;this.camera.aspect!==n&&(this.camera.aspect=n,this.camera.updateProjectionMatrix())}},{key:"dispose",value:function(){this.controls.dispose(),this.clearScene()}},{key:"makeDungeonVisual",value:function(e,t){this.clearScene();var n=this.createDungeonMesh(e,t);this.scene.add(n)}},{key:"clearScene",value:function(){for(var e=this.scene.children.length-1;e>=0;e--){var t=this.scene.children[e];if(t.name.includes("Dungeon")){for(var n=t.children.length-1;n>=0;n--){var o=t.children[n];if(o instanceof THREE.Mesh)o.material.dispose(),o.geometry.dispose();else for(var r=o.children.length-1;r>=0;r--){var i=o.children[r];i.material.dispose(),i.geometry.dispose(),i.parent.remove(i)}o.parent.remove(o)}t.parent.remove(t)}}}}]),e}();t["default"]=b},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(4),s=o(a);window.THREE=THREE,n(5),n(6);var c=new Event("disableWalker"),l={height:1.6,moveForward:!1,moveLeft:!1,moveBackward:!1,moveRight:!1,speedModifier:1,shiftSpeedModifier:2,jump:!1,isJumping:!1,moveForwardBackMultiplier:1,moveLeftRightMultiplier:.9,mobileRotateHorizontalMult:2,mobileRotateVerticalMult:1.6,velocity:new THREE.Vector3(0,0,0),raycaster:new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3(0,(-1),0),0,10),walkingSpeed:65,jumpStrength:8,gravity:30},u=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3,h=function(e){switch(e.keyCode){case 38:case 87:l.moveForward=!0;break;case 37:case 65:l.moveLeft=!0;break;case 40:case 83:l.moveBackward=!0;break;case 39:case 68:l.moveRight=!0;break;case 16:l.speedModifier=l.shiftSpeedModifier;break;case 32:l.jump=!0}},f=function(e){switch(e.keyCode){case 38:case 87:l.moveForward=!1;break;case 37:case 65:l.moveLeft=!1;break;case 40:case 83:l.moveBackward=!1;break;case 39:case 68:l.moveRight=!1;break;case 16:l.speedModifier=1;break;case 32:l.jump=!1}},v=function(){function e(t,n,o){r(this,e),this.camera=t,this.domElement=n,this.walkerEnabled=!1,this.orbitControls=new THREE.OrbitControls(t,n),this.orbitControls.enableDamping=!0,this.orbitControls.minDistance=1,this.orbitControls.maxDistance=1e3,this.orbitControls.rotateSpeed=.25,this.walkerControls=new THREE.PointerLockControls(t,n),this._controlsObject=this.walkerControls.getObject(),this._controlsObject.name="pointerLockObject",o.add(this._controlsObject),this.resetCameraOrbit(),this.navMesh=new THREE.Group}return i(e,[{key:"enableWalker",value:function(e){this.createNavMesh(e.rooms,e.tunnels);var t=Math.floor(Math.random()*e.rooms.length);this.resetCameraWalker(),this._controlsObject.position.fromArray([e.rooms[t].x,6,e.rooms[t].y]),this._controlsObject.rotation.y=0,this._controlsObject.children[0].rotation.x=0,this._addKeyboardListeners(),this._preparePointerLock(),this.orbitControls.enabled=!1,this.walkerControls.enabled=!0}},{key:"disableWalker",value:function(){this.resetCameraOrbit(),this._removeKeyboardListeners(),this._removePointerLock(),this.orbitControls.enabled=!0,this.walkerControls.enabled=!1,this.clearNavMesh(),document.dispatchEvent(c)}},{key:"resetCameraOrbit",value:function(){this.camera.position.fromArray(s["default"].camera.cameraPos),this.camera.lookAt(new THREE.Vector3(0,0,0)),this.camera.near=s["default"].camera.near,this.camera.far=s["default"].camera.far,this.camera.updateProjectionMatrix(),this._controlsObject.position.set(0,0,0),this._controlsObject.rotation.y=0,this._controlsObject.children[0].rotation.x=0}},{key:"resetCameraWalker",value:function(){this.camera.position.set(0,0,0),this.camera.rotation.set(0,0,0),this.camera.near=s["default"].camera.walkerNear,this.camera.far=s["default"].camera.walkerFar,this.camera.updateProjectionMatrix()}},{key:"update",value:function(e){if(this.orbitControls.enabled)this.orbitControls.update();else{var t=this._controlsObject,n=void 0;l.raycaster.ray.origin.copy(t.position);var o=[];o=l.raycaster.intersectObjects(this.navMesh.children,!1);var r=o.length>0;l.velocity.x-=10*l.velocity.x*e,l.velocity.z-=10*l.velocity.z*e,l.velocity.y-=l.gravity*e,l.moveForward&&(l.velocity.z-=l.walkingSpeed*l.speedModifier*l.moveForwardBackMultiplier*e),l.moveBackward&&(l.velocity.z+=l.walkingSpeed*l.speedModifier*l.moveForwardBackMultiplier*e),l.moveLeft&&(l.velocity.x-=l.walkingSpeed*l.speedModifier*l.moveLeftRightMultiplier*e),l.moveRight&&(l.velocity.x+=l.walkingSpeed*l.speedModifier*l.moveLeftRightMultiplier*e),l.jump&&!l.isJumping&&(l.velocity.y=l.jumpStrength,l.isJumping=!0),r&&(n=o[0],n.distance+l.velocity.y*e<=l.height&&(t.position.y=o[0].point.y+l.height,l.velocity.y=0,l.isJumping=!1)),t.translateY(l.velocity.y*e);var i=t.position.clone();t.translateX(l.velocity.x*e),t.translateZ(l.velocity.z*e),l.raycaster.ray.origin.copy(t.position),o=[],o=l.raycaster.intersectObjects(this.navMesh.children,!1);var a=o.length>0;if(r&&!a){var s=t.position.clone(),c=n.object.geometry.attributes.position.array;u.fromArray(c,3*n.face.a).applyMatrix4(n.object.matrixWorld),d.fromArray(c,3*n.face.b).applyMatrix4(n.object.matrixWorld),m.fromArray(c,3*n.face.c).applyMatrix4(n.object.matrixWorld);var h=new THREE.Vector3(0).add(u).add(d).add(m).divideScalar(3),f=this._linesIntersectsXZ(u,d,i,s);if(f.intersect||(f=this._linesIntersectsXZ(d,m,i,s),f.intersect||(f=this._linesIntersectsXZ(u,m,i,s))),f.intersect){var v=f.A,b=f.B,p=(new THREE.Vector3).subVectors(b,v),g=(new THREE.Vector3).subVectors(t.position,v).projectOnVector(p);g.add(v),g.add((new THREE.Vector3).subVectors(h,g).divideScalar(1e3)),g.y=i.y,t.position.copy(g)}else t.position.copy(i);l.raycaster.ray.origin.copy(t.position),o=[],o=l.raycaster.intersectObjects(this.navMesh.children,!1),o.length<1&&t.position.copy(i)}}}},{key:"_linesIntersectsXZ",value:function(e,t,n,o){var r=new THREE.Vector2(t.x-e.x,t.z-e.z),i=new THREE.Vector2(o.x-n.x,o.z-n.z),a=(-r.y*(e.x-n.x)+r.x*(e.z-n.z))/(-i.x*r.y+r.x*i.y),s=(i.x*(e.z-n.z)-i.y*(e.x-n.x))/(-i.x*r.y+r.x*i.y),c=a>=0&&a<=1&&s>=0&&s<=1;return{intersect:c,A:e,B:t}}},{key:"createNavMesh",value:function(e,t){for(var n=this.navMesh,o=new THREE.BoxBufferGeometry(1,1,1),r=void 0,i=void 0,a=void 0,c=void 0,l=void 0,u=void 0,d=0;d<e.length;d++){var m=new THREE.Mesh(o);m.scale.set(e[d].w-.04,s["default"].visParams.floorHeight,e[d].h-.04),m.position.set(e[d].x,0,e[d].y),n.add(m)}for(var h=0;h<t.length;h+=4)r=new THREE.Mesh(o),i=t[h+2]-t[h]>t[h+3]-t[h+1],a=i?(t[h]+t[h+2])/2:t[h]+.5,l=i?t[h+2]-t[h]-.04:.96,c=i?t[h+1]+.5:(t[h+1]+t[h+3])/2,u=i?.96:t[h+3]-t[h+1]-.04,r.scale.set(l,s["default"].visParams.tunnelHeight,u),r.position.set(a,0,c),n.add(r);n.updateMatrixWorld(!0)}},{key:"clearNavMesh",value:function(){for(var e=this.navMesh.children.length-1;e>=0;e--)this.navMesh.children[e].geometry.dispose(),this.navMesh.remove(this.navMesh.children[e])}},{key:"_pointerlockchange",value:function(){var e=document.body;document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e||this.disableWalker()}},{key:"_pointerlockerror",value:function(){var e=document.body;e.innerHTML="PointerLock Error"}},{key:"_preparePointerLock",value:function(){var e=document.body;"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document?(document.addEventListener("pointerlockchange",this._pointerlockchange.bind(this),!1),document.addEventListener("mozpointerlockchange",this._pointerlockchange.bind(this),!1),document.addEventListener("webkitpointerlockchange",this._pointerlockchange.bind(this),!1),document.addEventListener("pointerlockerror",this._pointerlockerror,!1),document.addEventListener("mozpointerlockerror",this._pointerlockerror,!1),document.addEventListener("webkitpointerlockerror",this._pointerlockerror,!1),e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock()):e.innerHTML="Bad browser; No pointer lock"}},{key:"_removePointerLock",value:function(){document.removeEventListener("pointerlockchange",this._pointerlockchange.bind(this),!1),document.removeEventListener("mozpointerlockchange",this._pointerlockchange.bind(this),!1),document.removeEventListener("webkitpointerlockchange",this._pointerlockchange.bind(this),!1),document.removeEventListener("pointerlockerror",this._pointerlockerror,!1),document.removeEventListener("mozpointerlockerror",this._pointerlockerror,!1),document.removeEventListener("webkitpointerlockerror",this._pointerlockerror,!1)}},{key:"_addKeyboardListeners",value:function(){document.addEventListener("keydown",h,!1),document.addEventListener("keyup",f,!1)}},{key:"_removeKeyboardListeners",value:function(){document.removeEventListener("keydown",h,!1),document.removeEventListener("keyup",f,!1)}},{key:"dispose",value:function(){this.orbitControls.dispose(),this.walkerControls.dispose()}}]),e}();t["default"]=v},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={global:{repoUrl:"https://github.com/mlknz/Dungeonizer.js"},generationMode:{withWalls:!0,isDebug:!1},dungeonParams:{roomSizeDistribution:"normal",dungeonSize:10,roomSizeMean:9,roomSizeDeviation:.75,mainRoomThreshold:1.1,connectivity:.7,density:.6,fromDungeonId:!1,dungeonId:""},camera:{cameraPos:[-90,110,50],near:1,far:1400,walkerNear:.005,walkerFar:100},visParams:{floorHeight:1,tunnelHeight:1,wallHeight:4,floorTunnelColor:[1,1,1],wallColor:[.6,.6,.6],mainFloorDebugColor:[.6,.1,.1],attachedFloorDebugColor:[.1,.4,.04],trashFloorDebugColor:[.3,.3,.3],trashFloorY:-.9,tunnelDebugHeight:1.2,tunnelDebugColor:[.7,.7,.7]}};t["default"]=n},function(e,t){THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*_.autoRotateSpeed}function o(){return Math.pow(.95,_.zoomSpeed)}function r(e){U.theta-=e}function i(e){U.phi-=e}function a(e){_.object instanceof THREE.PerspectiveCamera?V/=e:_.object instanceof THREE.OrthographicCamera?(_.object.zoom=Math.max(_.minZoom,Math.min(_.maxZoom,_.object.zoom*e)),_.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),_.enableZoom=!1)}function s(e){_.object instanceof THREE.PerspectiveCamera?V*=e:_.object instanceof THREE.OrthographicCamera?(_.object.zoom=Math.max(_.minZoom,Math.min(_.maxZoom,_.object.zoom/e)),_.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),_.enableZoom=!1)}function c(e){Y.set(e.clientX,e.clientY)}function l(e){J.set(e.clientX,e.clientY)}function u(e){X.set(e.clientX,e.clientY)}function d(e){Z.set(e.clientX,e.clientY),G.subVectors(Z,Y);var t=_.domElement===document?_.domElement.body:_.domElement;r(2*Math.PI*G.x/t.clientWidth*_.rotateSpeed),i(2*Math.PI*G.y/t.clientHeight*_.rotateSpeed),Y.copy(Z),_.update()}function m(e){Q.set(e.clientX,e.clientY),$.subVectors(Q,J),$.y>0?a(o()):$.y<0&&s(o()),J.copy(Q),_.update()}function h(e){q.set(e.clientX,e.clientY),K.subVectors(q,X),ne(K.x,K.y),X.copy(q),_.update()}function f(e){}function v(e){e.deltaY<0?s(o()):e.deltaY>0&&a(o()),_.update()}function b(e){switch(e.keyCode){case _.keys.UP:ne(0,_.keyPanSpeed),_.update();break;case _.keys.BOTTOM:ne(0,-_.keyPanSpeed),_.update();break;case _.keys.LEFT:ne(_.keyPanSpeed,0),_.update();break;case _.keys.RIGHT:ne(-_.keyPanSpeed,0),_.update()}}function p(e){Y.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);J.set(0,o)}function E(e){X.set(e.touches[0].pageX,e.touches[0].pageY)}function w(e){Z.set(e.touches[0].pageX,e.touches[0].pageY),G.subVectors(Z,Y);var t=_.domElement===document?_.domElement.body:_.domElement;r(2*Math.PI*G.x/t.clientWidth*_.rotateSpeed),i(2*Math.PI*G.y/t.clientHeight*_.rotateSpeed),Y.copy(Z),_.update()}function y(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);Q.set(0,r),$.subVectors(Q,J),$.y>0?s(o()):$.y<0&&a(o()),J.copy(Q),_.update()}function k(e){q.set(e.touches[0].pageX,e.touches[0].pageY),K.subVectors(q,X),ne(K.x,K.y),X.copy(q),_.update()}function T(e){}function R(e){if(_.enabled!==!1){if(e.preventDefault(),e.button===_.mouseButtons.ORBIT){if(_.enableRotate===!1)return;c(e),N=S.ROTATE}else if(e.button===_.mouseButtons.ZOOM){if(_.enableZoom===!1)return;l(e),N=S.DOLLY}else if(e.button===_.mouseButtons.PAN){if(_.enablePan===!1)return;u(e),N=S.PAN}N!==S.NONE&&(document.addEventListener("mousemove",H,!1),document.addEventListener("mouseup",x,!1),_.dispatchEvent(A))}}function H(e){if(_.enabled!==!1)if(e.preventDefault(),N===S.ROTATE){if(_.enableRotate===!1)return;d(e)}else if(N===S.DOLLY){if(_.enableZoom===!1)return;m(e)}else if(N===S.PAN){if(_.enablePan===!1)return;h(e)}}function x(e){_.enabled!==!1&&(f(e),document.removeEventListener("mousemove",H,!1),document.removeEventListener("mouseup",x,!1),_.dispatchEvent(z),N=S.NONE)}function M(e){_.enabled===!1||_.enableZoom===!1||N!==S.NONE&&N!==S.ROTATE||(e.preventDefault(),e.stopPropagation(),v(e),_.dispatchEvent(A),_.dispatchEvent(z))}function P(e){_.enabled!==!1&&_.enableKeys!==!1&&_.enablePan!==!1&&b(e)}function L(e){if(_.enabled!==!1){switch(e.touches.length){case 1:if(_.enableRotate===!1)return;p(e),N=S.TOUCH_ROTATE;break;case 2:if(_.enableZoom===!1)return;g(e),N=S.TOUCH_DOLLY;break;case 3:if(_.enablePan===!1)return;E(e),N=S.TOUCH_PAN;break;default:N=S.NONE}N!==S.NONE&&_.dispatchEvent(A)}}function C(e){if(_.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(_.enableRotate===!1)return;if(N!==S.TOUCH_ROTATE)return;w(e);break;case 2:if(_.enableZoom===!1)return;if(N!==S.TOUCH_DOLLY)return;y(e);break;case 3:if(_.enablePan===!1)return;if(N!==S.TOUCH_PAN)return;k(e);break;default:N=S.NONE}}function O(e){_.enabled!==!1&&(T(e),_.dispatchEvent(z),N=S.NONE)}function D(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return I.phi},this.getAzimuthalAngle=function(){return I.theta},this.reset=function(){_.target.copy(_.target0),_.object.position.copy(_.position0),_.object.zoom=_.zoom0,_.object.updateProjectionMatrix(),_.dispatchEvent(j),_.update(),N=S.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),i=o.clone().inverse(),a=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=_.object.position;return t.copy(e).sub(_.target),t.applyQuaternion(o),I.setFromVector3(t),_.autoRotate&&N===S.NONE&&r(n()),I.theta+=U.theta,I.phi+=U.phi,I.theta=Math.max(_.minAzimuthAngle,Math.min(_.maxAzimuthAngle,I.theta)),I.phi=Math.max(_.minPolarAngle,Math.min(_.maxPolarAngle,I.phi)),I.makeSafe(),I.radius*=V,I.radius=Math.max(_.minDistance,Math.min(_.maxDistance,I.radius)),_.target.add(B),t.setFromSpherical(I),t.applyQuaternion(i),e.copy(_.target).add(t),_.object.lookAt(_.target),_.enableDamping===!0?(U.theta*=1-_.dampingFactor,U.phi*=1-_.dampingFactor):U.set(0,0,0),V=1,B.set(0,0,0),!!(W||a.distanceToSquared(_.object.position)>F||8*(1-s.dot(_.object.quaternion))>F)&&(_.dispatchEvent(j),a.copy(_.object.position),s.copy(_.object.quaternion),W=!1,!0)}}(),this.dispose=function(){_.domElement.removeEventListener("contextmenu",D,!1),_.domElement.removeEventListener("mousedown",R,!1),_.domElement.removeEventListener("wheel",M,!1),_.domElement.removeEventListener("touchstart",L,!1),_.domElement.removeEventListener("touchend",O,!1),_.domElement.removeEventListener("touchmove",C,!1),document.removeEventListener("mousemove",H,!1),document.removeEventListener("mouseup",x,!1),window.removeEventListener("keydown",P,!1)};var _=this,j={type:"change"},A={type:"start"},z={type:"end"},S={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},N=S.NONE,F=1e-6,I=new THREE.Spherical,U=new THREE.Spherical,V=1,B=new THREE.Vector3,W=!1,Y=new THREE.Vector2,Z=new THREE.Vector2,G=new THREE.Vector2,X=new THREE.Vector2,q=new THREE.Vector2,K=new THREE.Vector2,J=new THREE.Vector2,Q=new THREE.Vector2,$=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),B.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),B.add(e)}}(),ne=function(){var e=new THREE.Vector3;return function(t,n){var o=_.domElement===document?_.domElement.body:_.domElement;if(_.object instanceof THREE.PerspectiveCamera){var r=_.object.position;e.copy(r).sub(_.target);var i=e.length();i*=Math.tan(_.object.fov/2*Math.PI/180),ee(2*t*i/o.clientHeight,_.object.matrix),te(2*n*i/o.clientHeight,_.object.matrix)}else _.object instanceof THREE.OrthographicCamera?(ee(t*(_.object.right-_.object.left)/_.object.zoom/o.clientWidth,_.object.matrix),te(n*(_.object.top-_.object.bottom)/_.object.zoom/o.clientHeight,_.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),_.enablePan=!1)}}();_.domElement.addEventListener("contextmenu",D,!1),_.domElement.addEventListener("mousedown",R,!1),_.domElement.addEventListener("wheel",M,!1),_.domElement.addEventListener("touchstart",L,!1),_.domElement.addEventListener("touchend",O,!1),_.domElement.addEventListener("touchmove",C,!1),window.addEventListener("keydown",P,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}})},function(e,t){THREE.PointerLockControls=function(e){var t=this;e.rotation.set(0,0,0);var n=new THREE.Object3D;n.add(e);var o=new THREE.Object3D;o.position.y=10,o.add(n);var r=Math.PI/2,i=function(e){if(t.enabled!==!1){var i=e.movementX||e.mozMovementX||e.webkitMovementX||0,a=e.movementY||e.mozMovementY||e.webkitMovementY||0;o.rotation.y-=.002*i,n.rotation.x-=.002*a,n.rotation.x=Math.max(-r,Math.min(r,n.rotation.x))}};this.dispose=function(){document.removeEventListener("mousemove",i,!1)},document.addEventListener("mousemove",i,!1),this.enabled=!1,this.getObject=function(){return o},this.getDirection=function(){var e=new THREE.Vector3(0,0,(-1)),t=new THREE.Euler(0,0,0,"YXZ");return function(r){return t.set(n.rotation.x,o.rotation.y,0),r.copy(e).applyEuler(t),r}}()}},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),a=o(i),s=n(9),c=o(s),l=function u(e,t){var n=t.isDebug,o=t.isTrashFloors,i=t.config;r(this,u);for(var s=[],l=[],d=[],m=n?i.mainFloorDebugColor:i.floorTunnelColor,h=i.attachedFloorDebugColor,f=i.trashFloorDebugColor,v=o?i.trashFloorY:0,b=0;b<e.length;b++)s.push(e[b].x,v,e[b].y),l.push(e[b].w,i.floorHeight,e[b].h),d.push.apply(d,o?f:e[b].isAttached?h:m);var p=new THREE.BoxBufferGeometry(1,1,1),g=new THREE.InstancedBufferGeometry;g.addAttribute("position",p.attributes.position),g.addAttribute("normal",p.attributes.normal),g.addAttribute("uv",p.attributes.uv),g.setIndex(p.index),g.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(s),3,1)),g.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(l),3,1)),g.addAttribute("color",new THREE.InstancedBufferAttribute(new Float32Array(d),3,1));var E=THREE.UniformsUtils.clone(THREE.UniformsLib.lights);E.opacity={value:o?.5:1},E.isDebug={value:n?1:0};var w=new THREE.RawShaderMaterial({uniforms:E,vertexShader:a["default"],fragmentShader:c["default"],side:THREE.FrontSide,transparent:!!o,lights:!0}),y=new THREE.Mesh(g,w);return y.name="floors_isTrash:"+o+"_isDebug:"+n,y};t["default"]=l},function(e,t){e.exports="attribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\n\r\nattribute vec3 offset;\r\nattribute vec3 scale;\r\nattribute vec3 color;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    mat4 modelMat = mat4(\r\n        scale.x, 0., 0., 0.,\r\n        0., scale.y, 0., 0.,\r\n        0., 0., scale.z, 0.,\r\n        offset.x, offset.y, offset.z, 1.\r\n    );\r\n\tgl_Position = projectionMatrix * viewMatrix * modelMat * vec4(position, 1.);\r\n\r\n\tvNormal = mat3(viewMatrix * modelMat) * normal;\r\n\tvColor = color;\r\n    vUv = uv * vec2(scale.x, scale.z);\r\n}\r\n"},function(e,t){e.exports="precision mediump float;\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\n#include <common>\r\n#include <lights_pars>\r\n\r\nuniform float opacity;\r\nuniform float isDebug;\r\n\r\nvoid main() {\r\n\r\n    vec2 uv = mod(vUv, 1.) - 0.5;\r\n    float d = clamp(uv.x * uv.x + uv.y * uv.y, 0., 1.);\r\n\tvec3 c = vColor * (isDebug > 0.5 ? 1. : d * d);\r\n\r\n    #if NUM_DIR_LIGHTS > 0\r\n    vec3 light;\r\n\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n\t\tlight = max( dot(normalize(vNormal), directionalLights[i].direction), 0.0) * directionalLights[i].color * 0.5;\r\n\t\tc += light;\r\n\t}\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(c, opacity);\r\n}\r\n"},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),a=o(i),s=n(12),c=o(s),l=n(8),u=o(l),d=n(9),m=o(d),h=function f(e,t){var n=t.isDebug,o=t.config,i=t.isWall;r(this,f);for(var s=[],l=[],d=[],h=i?o.wallColor:n?o.tunnelDebugColor:o.floorTunnelColor,v=i?o.wallHeight:n?o.tunnelDebugHeight:o.tunnelHeight,b=i?v/2-.5:0,p=void 0,g=void 0,E=void 0,w=void 0,y=void 0,k=0;k<e.length;k+=4){p=e[k+2]-e[k]>e[k+3]-e[k+1],g=p?(e[k]+e[k+2])/2:e[k]+.5,w=p?e[k+2]-e[k]:1,E=p?e[k+1]+.5:(e[k+1]+e[k+3])/2,y=p?1:e[k+3]-e[k+1],s.push(g,b,E),l.push(w,v,y);var T=[Math.abs(Math.sin(157.21355*g)),Math.abs(Math.sin(157.21355*g*E))/3,Math.abs(Math.sin(157.21355*E))];d.push.apply(d,i&&n?T:h)}var R=new THREE.BoxBufferGeometry(1,1,1),H=new THREE.InstancedBufferGeometry;if(i||n)for(var x=0;x<R.attributes.position.array.length/3;x++)R.attributes.position.array[3*x+1]<0?R.attributes.uv.array[2*x+1]=0:R.attributes.uv.array[2*x+1]=1;H.addAttribute("position",R.attributes.position),H.addAttribute("normal",R.attributes.normal),H.addAttribute("uv",R.attributes.uv),H.setIndex(R.index),H.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(s),3,1)),H.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(l),3,1)),H.addAttribute("color",new THREE.InstancedBufferAttribute(new Float32Array(d),3,1));var M=THREE.UniformsUtils.clone(THREE.UniformsLib.lights);M.isDebug={value:n?1:0};var P=new THREE.RawShaderMaterial({uniforms:M,vertexShader:i||n?a["default"]:u["default"],fragmentShader:i||n?c["default"]:m["default"],side:THREE.FrontSide,transparent:!1,lights:!0}),L=new THREE.Mesh(H,P);return L.name=(i?"walls_isDebug:":"tunnels_isDebug")+n,L};t["default"]=h},function(e,t){e.exports="attribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv;\r\nattribute vec3 color;\r\n\r\nattribute vec3 offset;\r\nattribute vec3 scale;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec3 vNormal;\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    mat4 modelMat = mat4(\r\n        scale.x, 0., 0., 0.,\r\n        0., scale.y, 0., 0.,\r\n        0., 0., scale.z, 0.,\r\n        offset.x, offset.y, offset.z, 1.\r\n    );\r\n\tgl_Position = projectionMatrix * viewMatrix * modelMat * vec4(position, 1.);\r\n\r\n\tvNormal = mat3(viewMatrix * modelMat) * normal;\r\n    vColor = color;\r\n    vUv = uv;\r\n}\r\n"},function(e,t){e.exports="precision mediump float;\r\nvarying vec3 vNormal;\r\n\r\n#include <common>\r\n#include <lights_pars>\r\n\r\nvarying vec3 vColor;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec3 c = vColor * sqrt(vUv.y);\r\n\r\n    #if NUM_DIR_LIGHTS > 0\r\n    vec3 light;\r\n\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n\t\tlight = max( dot(normalize(vNormal), directionalLights[i].direction), 0.0) * directionalLights[i].color * 0.5;\r\n\t\tc += light;\r\n\t}\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(c, 1.0);\r\n}\r\n"},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=0,r=function i(e,t){n(this,i);var r=new THREE.Object3D;r.name="lines_container_"+o,o++;for(var a=new THREE.LineBasicMaterial({color:t}),s=0;s<e.length;s+=4){var c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(e[s],1,e[s+1]),new THREE.Vector3(e[s+2],1,e[s+3]));var l=new THREE.Line(c,a);r.add(l)}return r};t["default"]=r},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(4),s=o(a),c=n(15)(),l=function(){function e(t){var n=this;r(this,e),this.dungeonVisualizer=t,this.dungeon=null,this.dungeonParams=s["default"].dungeonParams;var o=new dat.GUI({width:c.desktop()?400:300});this.gui=o,o.add(this.dungeonParams,"dungeonSize").min(1).max(120).step(1).name("Dungeon Size");
var i=o.addFolder("Rooms");i.add(this.dungeonParams,"roomSizeDistribution",{normal:"normal",uniform:"uniform"}),i.add(this.dungeonParams,"roomSizeMean").min(5).max(30).step(1),i.add(this.dungeonParams,"roomSizeDeviation").min(.1).max(.9).step(.01),i.add(this.dungeonParams,"mainRoomThreshold").min(1).max(1.33).step(.01),o.add(this.dungeonParams,"connectivity").min(0).max(1).step(.01).name("Connectivity"),o.add(this.dungeonParams,"density").min(0).max(1).step(.01).name("Density"),o.add(s["default"].generationMode,"withWalls").name("Draw Walls").onChange(function(){n.resetDungeon(!0)}),o.add(s["default"].generationMode,"isDebug").name("Debug Mode").onChange(function(){n.resetDungeon(!0)}),o.add(this.dungeonParams,"fromDungeonId").name("From Dungeon ID"),o.add(this.dungeonParams,"dungeonId").name("Dungeon ID").onChange().listen();var a={exportToFile:function(){n.exportDungeon(n.dungeon,n.dungeonParams.dungeonId)}};o.add(a,"exportToFile").name("Export to File");var l={jumpToSource:function(){window.open(s["default"].global.repoUrl,"_blank")}};o.add(l,"jumpToSource").name("Go to Source Code"),c.desktop()||o.close();var u=document.getElementById("generateButton");u.addEventListener("click",function(){n.resetDungeon()});var d=document.getElementById("walkerButton");d.addEventListener("click",function(){n.enableWalker()}),this.buttonsRoot=document.getElementById("buttonsRoot"),document.addEventListener("disableWalker",function(){c.desktop()&&o.open(),n.buttonsRoot.style.display=""})}return i(e,[{key:"generateNewDungeonId",value:function(){var e=(Math.random()+1).toString(36).substring(7,16),t=e+","+this.dungeonParams.dungeonSize+","+this.dungeonParams.roomSizeDistribution+","+this.dungeonParams.roomSizeMean+","+this.dungeonParams.roomSizeDeviation+","+this.dungeonParams.mainRoomThreshold+","+this.dungeonParams.connectivity+","+this.dungeonParams.density;return t}},{key:"resetDungeon",value:function(e){var t=e||this.dungeonParams.fromDungeonId?this.dungeonParams.dungeonId:this.generateNewDungeonId();this.dungeonParams.dungeonId=t;var n=window.dungeonizer.generateDungeonById(t,s["default"].generationMode.withWalls,s["default"].generationMode.isDebug);this.dungeon=n,this.dungeonVisualizer.makeDungeonVisual(this.dungeon,this.dungeonParams.dungeonId)}},{key:"enableWalker",value:function(){this.dungeonVisualizer.controls.enableWalker(this.dungeon),this.gui.close(),this.buttonsRoot.style.display="none"}},{key:"exportDungeon",value:function(e,t){var n=JSON.stringify({dungeonId:t,dungeon:e},null,4);window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,1048576,function(e){e.root.getFile("dungeon_"+t+".bin",{create:!0},function(e){e.createWriter(function(t){var o=new Blob([n]);t.addEventListener("writeend",function(){location.href=e.toURL()},!1),t.write(o)},function(){})},function(){})},function(){})}}]),e}();t["default"]=l},function(e,t,n){var o,r;!function(t){"use strict";var n=function(e,t){function n(t){return e.indexOf(t)!==-1}function o(e){var t;return t=new RegExp(e,"i"),c.className.match(t)}function r(e){o(e)||(c.className+=" "+e)}function i(e){o(e)&&(c.className=c.className.replace(e,""))}function a(t){var n=e.match(t);return n&&n.length>1&&n[1]||""}var s={},c=t||window.document.documentElement;e=(e||window.navigator.userAgent).toLowerCase(),s.ios=function(){return s.iphone()||s.ipod()||s.ipad()},s.iphone=function(){return n("iphone")},s.ipod=function(){return n("ipod")},s.ipad=function(){return n("ipad")},s.android=function(){return n("android")},s.androidPhone=function(){return s.android()&&n("mobile")},s.androidTablet=function(){return s.android()&&!n("mobile")},s.blackberry=function(){return n("blackberry")||n("bb10")||n("rim")},s.blackberryPhone=function(){return s.blackberry()&&!n("tablet")},s.blackberryTablet=function(){return s.blackberry()&&n("tablet")},s.windows=function(){return n("windows")},s.windowsPhone=function(){return s.windows()&&n("phone")},s.windowsTablet=function(){return s.windows()&&n("touch")&&!s.windowsPhone()},s.fxos=function(){return(n("(mobile;")||n("(tablet;"))&&n("; rv:")},s.fxosPhone=function(){return s.fxos()&&n("mobile")},s.fxosTablet=function(){return s.fxos()&&n("tablet")},s.meego=function(){return n("meego")},s.cordova=function(){return window.cordova&&"file:"===location.protocol},s.nodeWebkit=function(){return"object"==typeof window.process},s.bada=function(){return n("bada")},s.mobile=function(){return s.androidPhone()||s.iphone()||s.ipod()||s.windowsPhone()||s.blackberryPhone()||s.fxosPhone()||s.meego()},s.tablet=function(){return s.ipad()||s.androidTablet()||s.blackberryTablet()||s.windowsTablet()||s.fxosTablet()},s.desktop=function(){return!s.tablet()&&!s.mobile()},s.portrait=function(){return window.innerHeight/window.innerWidth>1},s.landscape=function(){return window.innerHeight/window.innerWidth<1},s.standAlone=function(){return window.navigator.standalone===!0},s.addClasses=function(){s._hasAddClasses||(s._hasAddClasses=!0,s.ios()?s.ipad()?r("ios ipad tablet"):s.iphone()?r("ios iphone mobile"):s.ipod()&&r("ios ipod mobile"):r(s.android()?s.androidTablet()?"android tablet":"android mobile":s.blackberry()?s.blackberryTablet()?"blackberry tablet":"blackberry mobile":s.windows()?s.windowsTablet()?"windows tablet":s.windowsPhone()?"windows mobile":"desktop":s.fxos()?s.fxosTablet()?"fxos tablet":"fxos mobile":s.meego()?"meego mobile":s.nodeWebkit()?"node-webkit":"desktop"),s.cordova()&&r("cordova"),s.standAlone()&&r("standalone"))};var l="";return s.ios()?(l=a(/os (\d+([_\s]\d+)*) like mac os x/i),l=l.replace(/[_\s]/g,".")):s.android()?l=a(/android[ \/-](\d+(\.\d+)*)/i):s.windowsPhone()?l=a(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):s.blackberry()?l=a(/rim\stablet\sos\s(\d+(\.\d+)*)/i):s.bada()&&(l=a(/bada\/(\d+(\.\d+)*)/i)),l&&(s.osversion=l),s.addOrientationClasses=function(){if(!s.hasOrientationListener){s.hasOrientationListener=!0;var e=function(){return s.landscape()?(i("portrait"),r("landscape")):(i("landscape"),r("portrait"))},t="onorientationchange"in window?"orientationchange":"resize";window.addEventListener?window.addEventListener(t,e,!1):window.attachEvent?window.attachEvent(t,e):window[t]=e,e()}},s};"undefined"!=typeof e&&e.exports?e.exports=n:(o=[],r=function(){return n}.apply(t,o),!(void 0!==r&&(e.exports=r)))}(this)},function(e,t){"use strict";e.exports=function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl"],n=!1,o=0;o<t.length;o++)try{if(n=e.getContext(t[o]),n&&"function"==typeof n.getParameter)return!0}catch(r){console.log("Unable to initialize WebGL. Your browser may not support it.")}return!1}return!1}}])});