!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={exports:{},id:o,loaded:!1};return e[o].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(4)},,,,function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function a(e){for(var t=[],n=[],o=[],a=0;a<e.length;a++)t.push((e[a].x1+e[a].x2)/2,0,(e[a].y1+e[a].y2)/2),n.push(e[a].x2-e[a].x1,m,e[a].y2-e[a].y1),o.push(e[a].isMain);var r=new THREE.InstancedBufferGeometry;r.addAttribute("position",h.attributes.position),r.addAttribute("normal",h.attributes.normal),r.setIndex(h.index),r.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(t),3,1)),r.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(n),3,1)),r.addAttribute("metaInfo",new THREE.InstancedBufferAttribute(new Float32Array(o),1,1));var i=THREE.UniformsUtils.clone(THREE.UniformsLib.lights),s=new THREE.RawShaderMaterial({uniforms:i,vertexShader:c["default"],fragmentShader:d["default"],side:THREE.DoubleSide,transparent:!1,lights:!0});return new THREE.Mesh(r,s)}function r(e){for(var t,n,o,a,r,i=[],s=[],u=[],l=0;l<e.length;l+=4)t=e[l],o=e[l+1],n=e[l+2],a=e[l+3],i.push((t+n)/2,0,(o+a)/2),r=Math.abs(n-t)>Math.abs(a-o),s.push(r?Math.abs(n-t)+p/2:p,E,r?p:Math.abs(a-o)+p/2),u.push(-1);var m=new THREE.InstancedBufferGeometry;m.addAttribute("position",h.attributes.position),m.addAttribute("normal",h.attributes.normal),m.setIndex(h.index),m.addAttribute("offset",new THREE.InstancedBufferAttribute(new Float32Array(i),3,1)),m.addAttribute("scale",new THREE.InstancedBufferAttribute(new Float32Array(s),3,1)),m.addAttribute("metaInfo",new THREE.InstancedBufferAttribute(new Float32Array(u),1,1));var b=THREE.UniformsUtils.clone(THREE.UniformsLib.lights),f=new THREE.RawShaderMaterial({uniforms:b,vertexShader:c["default"],fragmentShader:d["default"],side:THREE.DoubleSide,transparent:!1,lights:!0});return new THREE.Mesh(m,f)}function i(e,t){for(var n=new THREE.Object3D,o=new THREE.LineBasicMaterial({color:t}),a=0;a<e.length;a+=4){var r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(e[a],1,e[a+1]),new THREE.Vector3(e[a+2],1,e[a+3]));var i=new THREE.Line(r,o);n.add(i)}return n}var s=n(5),c=o(s),u=n(6),d=o(u),l={};window.THREE=THREE,n(7);var m=1,E=1.7,p=1.2,h=new THREE.BoxBufferGeometry(1,1,1);window.dungeonizer=window.dungeonizer||{},window.dungeonizer.visualize=function(e){e.setClearColor(3359778,1),e.clear();var t=e.getContext();l.renderer=e,l.aspectRatio=t.canvas.clientWidth/t.canvas.clientHeight;var n=new THREE.PerspectiveCamera(60,l.aspectRatio,1,1e4);n.position.z=76,n.position.y=70,n.position.x=62,n.lookAt(new THREE.Vector3(0,0,0)),n.updateProjectionMatrix();var o=window.dungeonizer.generateDungeon(),s=new THREE.Scene,c=a(o.floors);s.add(c);var u=r(o.tunnels);s.add(u);var d=i(o.triangles,255);s.add(d);var m=i(o.leftAliveLines,65280);s.add(m);var E=new THREE.AmbientLight(2105376);s.add(E);var p=new THREE.DirectionalLight(11184810);p.position.set(10,20,10),s.add(p);var h=new THREE.OrbitControls(n,e.domElement);return h.enableDamping=!0,{scene:s,update:function(){l.time=(new Date).getTime(),h.update(),e.render(s,n)},resize:function(e,t){l.aspectRatio=e/t,n.aspect!==l.aspectRatio&&(console.log("QQ"),n.aspect=l.aspectRatio,n.updateProjectionMatrix())},dispose:function(){h.dispose()}}}},function(e,t){e.exports="attribute vec3 position;\r\nattribute vec3 normal;\r\n\r\nattribute vec3 offset;\r\nattribute vec3 scale;\r\nattribute float metaInfo;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec3 vNormal;\r\nvarying float vIsMain;\r\n\r\nvoid main() {\r\n    mat4 modelMat = mat4(\r\n        scale.x, 0., 0., 0.,\r\n        0., scale.y, 0., 0.,\r\n        0., 0., scale.z, 0.,\r\n        offset.x, offset.y, offset.z, 1.\r\n    );\r\n\tgl_Position = projectionMatrix * viewMatrix * modelMat * vec4(position, 1.);\r\n\r\n\tvNormal = mat3(viewMatrix * modelMat) * normal;\r\n\tvIsMain = metaInfo;\r\n}\r\n"},function(e,t){e.exports="precision mediump float;\r\nvarying vec3 vNormal;\r\nvarying float vIsMain;\r\n\r\n#include <common>\r\n#include <lights_pars>\r\n\r\nvoid main() {\r\n\tvec3 light;\r\n\r\n\tvec3 c = (vIsMain < -0.5) ? vec3(0.8, 0.8, 0.8) : (vIsMain > 1.5) ? vec3(0.2, 0.5, 0.1) : (vIsMain > 0.5) ? vec3(0.6, 0., 0) : ambientLightColor;\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n\t\tlight = max( dot(normalize(vNormal), directionalLights[i].direction), 0.0) * directionalLights[i].color * 0.5;\r\n\t\tc += light;\r\n\t}\r\n\t#endif\r\n\r\n\tgl_FragColor = vec4(c, 1.0);\r\n}\r\n"},function(e,t){THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*N.autoRotateSpeed}function o(){return Math.pow(.95,N.zoomSpeed)}function a(e){F.theta-=e}function r(e){F.phi-=e}function i(e){N.object instanceof THREE.PerspectiveCamera?Z/=e:N.object instanceof THREE.OrthographicCamera?(N.object.zoom=Math.max(N.minZoom,Math.min(N.maxZoom,N.object.zoom*e)),N.object.updateProjectionMatrix(),B=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),N.enableZoom=!1)}function s(e){N.object instanceof THREE.PerspectiveCamera?Z*=e:N.object instanceof THREE.OrthographicCamera?(N.object.zoom=Math.max(N.minZoom,Math.min(N.maxZoom,N.object.zoom/e)),N.object.updateProjectionMatrix(),B=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),N.enableZoom=!1)}function c(e){_.set(e.clientX,e.clientY)}function u(e){q.set(e.clientX,e.clientY)}function d(e){K.set(e.clientX,e.clientY)}function l(e){X.set(e.clientX,e.clientY),G.subVectors(X,_);var t=N.domElement===document?N.domElement.body:N.domElement;a(2*Math.PI*G.x/t.clientWidth*N.rotateSpeed),r(2*Math.PI*G.y/t.clientHeight*N.rotateSpeed),_.copy(X),N.update()}function m(e){J.set(e.clientX,e.clientY),$.subVectors(J,q),$.y>0?i(o()):$.y<0&&s(o()),q.copy(J),N.update()}function E(e){W.set(e.clientX,e.clientY),Q.subVectors(W,K),ne(Q.x,Q.y),K.copy(W),N.update()}function p(e){}function h(e){e.deltaY<0?s(o()):e.deltaY>0&&i(o()),N.update()}function b(e){switch(e.keyCode){case N.keys.UP:ne(0,N.keyPanSpeed),N.update();break;case N.keys.BOTTOM:ne(0,-N.keyPanSpeed),N.update();break;case N.keys.LEFT:ne(N.keyPanSpeed,0),N.update();break;case N.keys.RIGHT:ne(-N.keyPanSpeed,0),N.update()}}function f(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}function v(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);q.set(0,o)}function R(e){K.set(e.touches[0].pageX,e.touches[0].pageY)}function T(e){X.set(e.touches[0].pageX,e.touches[0].pageY),G.subVectors(X,_);var t=N.domElement===document?N.domElement.body:N.domElement;a(2*Math.PI*G.x/t.clientWidth*N.rotateSpeed),r(2*Math.PI*G.y/t.clientHeight*N.rotateSpeed),_.copy(X),N.update()}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);J.set(0,a),$.subVectors(J,q),$.y>0?s(o()):$.y<0&&i(o()),q.copy(J),N.update()}function H(e){W.set(e.touches[0].pageX,e.touches[0].pageY),Q.subVectors(W,K),ne(Q.x,Q.y),K.copy(W),N.update()}function w(e){}function y(e){if(N.enabled!==!1){if(e.preventDefault(),e.button===N.mouseButtons.ORBIT){if(N.enableRotate===!1)return;c(e),z=U.ROTATE}else if(e.button===N.mouseButtons.ZOOM){if(N.enableZoom===!1)return;u(e),z=U.DOLLY}else if(e.button===N.mouseButtons.PAN){if(N.enablePan===!1)return;d(e),z=U.PAN}z!==U.NONE&&(document.addEventListener("mousemove",O,!1),document.addEventListener("mouseup",M,!1),N.dispatchEvent(D))}}function O(e){if(N.enabled!==!1)if(e.preventDefault(),z===U.ROTATE){if(N.enableRotate===!1)return;l(e)}else if(z===U.DOLLY){if(N.enableZoom===!1)return;m(e)}else if(z===U.PAN){if(N.enablePan===!1)return;E(e)}}function M(e){N.enabled!==!1&&(p(e),document.removeEventListener("mousemove",O,!1),document.removeEventListener("mouseup",M,!1),N.dispatchEvent(S),z=U.NONE)}function x(e){N.enabled===!1||N.enableZoom===!1||z!==U.NONE&&z!==U.ROTATE||(e.preventDefault(),e.stopPropagation(),h(e),N.dispatchEvent(D),N.dispatchEvent(S))}function A(e){N.enabled!==!1&&N.enableKeys!==!1&&N.enablePan!==!1&&b(e)}function P(e){if(N.enabled!==!1){switch(e.touches.length){case 1:if(N.enableRotate===!1)return;f(e),z=U.TOUCH_ROTATE;break;case 2:if(N.enableZoom===!1)return;v(e),z=U.TOUCH_DOLLY;break;case 3:if(N.enablePan===!1)return;R(e),z=U.TOUCH_PAN;break;default:z=U.NONE}z!==U.NONE&&N.dispatchEvent(D)}}function j(e){if(N.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(N.enableRotate===!1)return;if(z!==U.TOUCH_ROTATE)return;T(e);break;case 2:if(N.enableZoom===!1)return;if(z!==U.TOUCH_DOLLY)return;g(e);break;case 3:if(N.enablePan===!1)return;if(z!==U.TOUCH_PAN)return;H(e);break;default:z=U.NONE}}function L(e){N.enabled!==!1&&(w(e),N.dispatchEvent(S),z=U.NONE)}function C(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return V.phi},this.getAzimuthalAngle=function(){return V.theta},this.reset=function(){N.target.copy(N.target0),N.object.position.copy(N.position0),N.object.zoom=N.zoom0,N.object.updateProjectionMatrix(),N.dispatchEvent(I),N.update(),z=U.NONE},this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),r=o.clone().inverse(),i=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=N.object.position;return t.copy(e).sub(N.target),t.applyQuaternion(o),V.setFromVector3(t),N.autoRotate&&z===U.NONE&&a(n()),V.theta+=F.theta,V.phi+=F.phi,V.theta=Math.max(N.minAzimuthAngle,Math.min(N.maxAzimuthAngle,V.theta)),V.phi=Math.max(N.minPolarAngle,Math.min(N.maxPolarAngle,V.phi)),V.makeSafe(),V.radius*=Z,V.radius=Math.max(N.minDistance,Math.min(N.maxDistance,V.radius)),N.target.add(Y),t.setFromSpherical(V),t.applyQuaternion(r),e.copy(N.target).add(t),N.object.lookAt(N.target),N.enableDamping===!0?(F.theta*=1-N.dampingFactor,F.phi*=1-N.dampingFactor):F.set(0,0,0),Z=1,Y.set(0,0,0),!!(B||i.distanceToSquared(N.object.position)>k||8*(1-s.dot(N.object.quaternion))>k)&&(N.dispatchEvent(I),i.copy(N.object.position),s.copy(N.object.quaternion),B=!1,!0)}}(),this.dispose=function(){N.domElement.removeEventListener("contextmenu",C,!1),N.domElement.removeEventListener("mousedown",y,!1),N.domElement.removeEventListener("wheel",x,!1),N.domElement.removeEventListener("touchstart",P,!1),N.domElement.removeEventListener("touchend",L,!1),N.domElement.removeEventListener("touchmove",j,!1),document.removeEventListener("mousemove",O,!1),document.removeEventListener("mouseup",M,!1),window.removeEventListener("keydown",A,!1)};var N=this,I={type:"change"},D={type:"start"},S={type:"end"},U={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},z=U.NONE,k=1e-6,V=new THREE.Spherical,F=new THREE.Spherical,Z=1,Y=new THREE.Vector3,B=!1,_=new THREE.Vector2,X=new THREE.Vector2,G=new THREE.Vector2,K=new THREE.Vector2,W=new THREE.Vector2,Q=new THREE.Vector2,q=new THREE.Vector2,J=new THREE.Vector2,$=new THREE.Vector2,ee=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),Y.add(e)}}(),te=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),Y.add(e)}}(),ne=function(){var e=new THREE.Vector3;return function(t,n){var o=N.domElement===document?N.domElement.body:N.domElement;if(N.object instanceof THREE.PerspectiveCamera){var a=N.object.position;e.copy(a).sub(N.target);var r=e.length();r*=Math.tan(N.object.fov/2*Math.PI/180),ee(2*t*r/o.clientHeight,N.object.matrix),te(2*n*r/o.clientHeight,N.object.matrix)}else N.object instanceof THREE.OrthographicCamera?(ee(t*(N.object.right-N.object.left)/N.object.zoom/o.clientWidth,N.object.matrix),te(n*(N.object.top-N.object.bottom)/N.object.zoom/o.clientHeight,N.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),N.enablePan=!1)}}();N.domElement.addEventListener("contextmenu",C,!1),N.domElement.addEventListener("mousedown",y,!1),N.domElement.addEventListener("wheel",x,!1),N.domElement.addEventListener("touchstart",P,!1),N.domElement.addEventListener("touchend",L,!1),N.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",A,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}})}])});